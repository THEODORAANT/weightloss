<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UK Postcode Autocomplete</title>
    <style>
        #suggestions {
            border: 1px solid #ccc;
            max-width: 300px;
            margin-top: 5px;
            position: absolute;
            background: white;
        }
        #suggestions div {
            padding: 5px;
            cursor: pointer;
        }
        #suggestions div:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
<h2>UK Postcode Autocomplete</h2>
<input type="text" id="address" placeholder="Start typing address..." autocomplete="off" />
<div id="suggestions"></div>
<p id="selectedResult"></p>

<script>
    const addressInput = document.getElementById('address');
    const suggestionsBox = document.getElementById('suggestions');
    const resultDisplay = document.getElementById('selectedResult');

    let debounceTimer;

    addressInput.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        const query = addressInput.value.trim();
        if (query.length < 3) {
            suggestionsBox.innerHTML = '';
            return;
        }

        debounceTimer = setTimeout(() => {
            fetch('lookup.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'query=' + encodeURIComponent(query)
            })
                .then(response => response.json())
                .then(data => {
                    suggestionsBox.innerHTML = '';
                    if (data.length === 0) return;

                    data.forEach(item => {
                        const div = document.createElement('div');
                        div.textContent = item;
                        div.onclick = () => {
                            addressInput.value = item;
                            suggestionsBox.innerHTML = '';
                            resultDisplay.textContent = "Selected: " + item;
                        };
                        suggestionsBox.appendChild(div);
                    });
                });
        }, 300); // debounce to avoid excessive requests
    });

    document.addEventListener('click', (e) => {
        if (!suggestionsBox.contains(e.target) && e.target !== addressInput) {
            suggestionsBox.innerHTML = '';
        }
    });
</script>
</body>
</html>
