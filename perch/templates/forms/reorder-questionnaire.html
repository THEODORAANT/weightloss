<perch:form id="questionnaire" method="POST" app="perch_forms" action="/client/questionnaire-re-order" >

    <perch:if id="step" match="within" value="weight">
        <section class="how_old">
            <div class="contanier">
                <div class="what_Is_your">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <h2 class="js-question-label-weight">What is your current weight?</h2>
                    <div class="weight-inputs">
                        <input type="text" id="weight"  required name="weight" placeholder="Kg">
                        <input type="hidden" id="weight2"  required name="weight2" placeholder="lbs">
                        <input type="hidden" id="weightunit" value="kg"   name="weightunit" >


                    </div>
                    <div class="unit-selector unit_selector">
                        <label><input type="radio" required onchange="radioweight(this.value)" name="weightradio-unit" id="weightradio-kg" value="kg" checked >kg</label>
                        <label><input type="radio" onchange="radioweight(this.value)" name="weightradio-unit"  id="weightradio-lbs" value="st-lbs"> st/lbs</label>
                    </div>
                    <div class="buttons">
                        <input type="hidden" id="nextstep" name="nextstep" value="side-effects">
                        <button class="back"><a href="/client/re-order" style="text-decoration: none;color: #000;" >Back</a></button>
                        <button onclick="submitForm('weight')"   class="next"><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>
                </div>

            </div>

        </section>
        <script>


            function radioweight(value) {

                const weight = document.getElementById("weight");

                document.getElementById("weightunit").value = value;
                if (value === "kg") {
                    weight.placeholder = "Kg";
                    document.getElementById("weight2").type = "hidden";
                } else {
                    document.getElementById("weight2").type = "text";
                    weight.placeholder = "st";

                }


            }


        </script>
    </perch:if>
    <perch:if id="step" value="side-effects">
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2 class="js-question-label-side_effects">Have you experienced any side effects whilst taking the medication? </h2>
                    </div>


                    <div class="unde">

                        <div class="button-group">
                            <button id="yesBtn" onclick="setValuesreorderForm('side_effects','yes')"  class="custom_btn"><span data-question-option-key="side_effects" data-question-option-value="yes" style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesreorderForm('side_effects','no')"  class="custom_btn"><span data-question-option-key="side_effects" data-question-option-value="no" style="text-decoration: none; color: #000;" >No</span></button>
                            <input type="hidden" id="nextstep" name="nextstep" value="more_side_effects">
                            <input type="hidden" id="side_effects" name="more_side_effects" value="">


                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href="/client/questionnaire-re-order?step=weight">Back</a></button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </perch:if>
    <perch:if id="step" value="more_side_effects" >

        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="more_side_effects" class="js-question-label-more_side_effects">Please tell us as much as you can about your side effects - the type, duration, severity and whether they have resolved.</label>
                    <textarea id="more_side_effects" required name="more_side_effects" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href="/client/questionnaire-re-order?step=side_effects">Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="additional-medication">
                        <button type="submit"  onclick="submitForm('more_side_effects')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>

                    </div>
                </form>
            </div>
        </section>



    </perch:if>

    <perch:if id="step" value="additional-medication">
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2 class="js-question-label-additional_medication">Have you started taking any additional medication? </h2>
                    </div>


                    <div class="unde">

                        <div class="button-group">
                            <button id="yesBtn" onclick="setValuesreorderForm('additional-medication','yes')"  class="custom_btn"><span data-question-option-key="additional_medication" data-question-option-value="yes" style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesreorderForm('additional-medication','no')"  class="custom_btn"><span data-question-option-key="additional_medication" data-question-option-value="no" style="text-decoration: none; color: #000;" >No</span></button>
                            <input type="hidden" id="nextstep" name="nextstep" value="list_additional_medication">
                            <input type="hidden" id="additional-medication" name="additional-medication" value="">


                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href="/client/questionnaire-re-order?step=side-effects">Back</a></button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </perch:if>
    <perch:if id="step" value="list_additional_medication" >

        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="list_additional_medication" class="js-question-label-list_additional_medication">Please tell us as much as you can about your side effects - the type, duration, severity and whether they have resolved.</label>
                    <textarea id="list_additional_medication" required name="list_additional_medication" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href="/client/reorder-questionnaire?step=effects_with_wegovy">Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="rate_current_experience">
                        <button type="submit"  onclick="submitForm('list_additional_medication')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>

                    </div>
                </form>
            </div>
        </section>



    </perch:if>

    <perch:if id="step" value="rate_current_experience">
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2 class="js-question-label-rate_current_experience">Are you happy with your monthly weight loss?</h2>
                    </div>


                    <div class="unde">

                        <div class="button-group">
                            <button id="yesBtn" onclick="setValuesreorderForm('rate_current_experience','yes')"  class="custom_btn"><span data-question-option-key="rate_current_experience" data-question-option-value="yes" style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesreorderForm('rate_current_experience','no')"  class="custom_btn"><span data-question-option-key="rate_current_experience" data-question-option-value="no" style="text-decoration: none; color: #000;" >No</span></button>
                            <input type="hidden" id="nextstep" name="nextstep" value="contact">
                            <input type="hidden" id="rate_current_experience" name="rate_current_experience" value="">


                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href="/client/questionnaire-re-order?step=rate_current_experience">Back</a></button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </perch:if>
    <perch:if id="step" value="no-happy" >

        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="no_happy_reasons" class="js-question-label-no_happy_reasons">Please tell us as much as you can about the reasons you are not happy with your monthly weight loss.</label>
                    <textarea id="no_happy_reasons" required name="no_happy_reasons" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href="/client/questionnaire-re-order?step=rate_current_experience">Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="contact">
                        <button type="submit"  onclick="submitForm('no_happy_reasons')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>

                    </div>
                </form>
            </div>
        </section>



    </perch:if>


    <perch:if id="step" value="chat_with_us">
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2 class="js-question-label-chat_with_us">Would you like to chat with someone?</h2>
                    </div>


                    <div class="unde">

                        <div class="button-group">
                            <button id="yesBtn" onclick="setValuesreorderForm('chat_with_us','yes')"  class="custom_btn"><span data-question-option-key="chat_with_us" data-question-option-value="yes" style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesreorderForm('chat_with_us','no')"  class="custom_btn"><span data-question-option-key="chat_with_us" data-question-option-value="no" style="text-decoration: none; color: #000;" >No</span></button>
                            <input type="hidden" id="nextstep" name="nextstep" value="contact">
                            <input type="hidden" id="chat_with_us" name="chat_with_us" value="">


                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href="/client/questionnaire-re-order?step=rate_current_experience">Back</a></button>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </perch:if>

    <perch:if id="step" value="contact" >

        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                </div>
                <h2 class="js-question-label-email_address">Please enter your  email address</h2>
                <div class="weight-inputs">
                    <input type="text" id="email_address"  name="email_address" placeholder="e-mail address" style="width: 100%;" >

                    <input type="hidden" id="nextstep" name="nextstep" value="cart">

                </div>


                <div class="buttons skip ">
                    <button class="back skip_button "><a href="/order/cart" style="text-decoration: none;color: #000;" >Skip</a></button>
                </div>


                <div class="buttons">
                    <button class="back"><a href="/client/questionnaire-re-order?step=chat_with_us" style="text-decoration: none;color: #000;" >Back</a></button>
                    <button onclick="submitForm('email_address')" class="next"><span style="text-decoration: none;color: #000;" >Next →</span></button>
                </div>
            </div>
        </section>



    </perch:if>

    <script type="application/json" class="js-questionnaire-structure"><perch:forms id="questionnaire_structure_json" encode="false" /></script>
    <perch:if exists="questionnaire_dependencies_json">
        <script type="application/json" class="js-questionnaire-dependencies"><perch:forms id="questionnaire_dependencies_json" encode="false" /></script>
    </perch:if>
    <script>
        (function () {
            var scripts = document.querySelectorAll('.js-questionnaire-structure');
            if (!scripts.length) {
                return;
            }

            function slugify(value) {
                return (value || '').toString().trim().toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/^_+|_+$/g, '');
            }

            function parseJSON(el) {
                try {
                    return JSON.parse(el.textContent || el.innerText || 'null');
                } catch (e) {
                    return null;
                }
            }

            function cssEscape(val) {
                return (val || '').toString().replace(/\\/g, '\\\\').replace(/"/g, '\\"');
            }

            scripts.forEach(function (script) {
                var structure = parseJSON(script);
                if (!structure) {
                    return;
                }

                var form = script.closest('form') || document;

                Object.keys(structure).forEach(function (key) {
                    var question = structure[key];
                    var questionSlug = slugify(key);
                    var labelNodes = form.querySelectorAll('.js-question-label-' + questionSlug);

                    labelNodes.forEach(function (node) {
                        node.textContent = question.label;
                    });

                    if (!question.options || typeof question.options !== 'object') {
                        return;
                    }

                    Object.keys(question.options).forEach(function (optionKey) {
                        var optionValue = question.options[optionKey];
                        var optionLabel = optionValue;

                        if (optionValue && typeof optionValue === 'object') {
                            if (optionValue.label) {
                                optionLabel = optionValue.label;
                            } else if (optionValue.title) {
                                optionLabel = optionValue.title;
                            } else if (optionValue.value) {
                                optionLabel = optionValue.value;
                            }
                        }

                        var value = optionKey;
                        var selectorNames = [];
                        if (question.name) {
                            selectorNames.push(question.name);
                            if (question.name.slice(-2) === '[]') {
                                selectorNames.push(question.name.slice(0, -2) + '[]');
                            }
                        }

                        selectorNames.push(key);
                        if (key.slice(-2) === '[]') {
                            selectorNames.push(key.slice(0, -2) + '[]');
                        }

                        var inputs = [];
                        selectorNames.forEach(function (name) {
                            var escapedName = cssEscape(name);
                            var escapedValue = cssEscape(value);
                            var found = form.querySelectorAll('input[name="' + escapedName + '"][value="' + escapedValue + '"]');
                            found.forEach(function (input) {
                                inputs.push(input);
                            });
                        });

                        inputs.forEach(function (input) {
                            var target = null;

                            if (input.id) {
                                target = form.querySelector('label[for="' + cssEscape(input.id) + '"]');
                            }

                            if (!target && input.parentElement) {
                                target = input.parentElement.querySelector('label');
                            }

                            if (!target && input.parentElement) {
                                target = input.parentElement.querySelector('.box_text');
                            }

                            if (!target && input.nextElementSibling && input.nextElementSibling.tagName === 'SPAN') {
                                target = input.nextElementSibling;
                            }

                            if (target) {
                                target.textContent = optionLabel;
                            }
                        });

                        var optionSlug = slugify(optionKey);
                        var buttonTargets = form.querySelectorAll('[data-question-option-key="' + questionSlug + '"][data-question-option-value="' + optionSlug + '"]');
                        buttonTargets.forEach(function (node) {
                            node.textContent = optionLabel;
                        });
                    });
                });

                var dependencyScript = form.querySelector('.js-questionnaire-dependencies');
                if (dependencyScript) {
                    var dependencies = parseJSON(dependencyScript);
                    if (dependencies) {
                        form.dataset.questionnaireDependencies = JSON.stringify(dependencies);
                    }
                }
            });
        })();
    </script>
</perch:form>
