<perch:form id="questionnaire" method="POST" app="perch_forms" action="/get-started/questionnaire" >
    <script type="application/json" id="medication-step-data"><perch:forms id="medication_weight_json" encode="false" /></script>
    <script>
        (function () {
            if (window.getMedicationStepData) {
                return;
            }

            window.getMedicationStepData = function () {
                if (window.__medicationStepData) {
                    return window.__medicationStepData;
                }

                const dataElement = document.getElementById('medication-step-data');
                let parsed = [];

                if (dataElement) {
                    const raw = dataElement.textContent ? dataElement.textContent.trim() : '';
                    if (raw) {
                        try {
                            parsed = JSON.parse(raw);
                        } catch (error) {
                            console.error('Unable to parse medication configuration data', error);
                        }
                    }
                }

                if (!Array.isArray(parsed) || parsed.length === 0) {
                    parsed = [{
                        slug: 'wegovy',
                        label: 'the weight loss medication',
                        weight: '',
                        weight2: '',
                        unit: 'kg',
                        dose: '',
                        recentDose: '',
                        continueDose: ''
                    }];
                }

                window.__medicationStepData = parsed.map(function (item, index) {
                    const slug = (item && typeof item.slug === 'string' && item.slug.trim() !== '')
                        ? item.slug.trim()
                        : `medication-${index + 1}`;

                    const recentDoseOptions = (item && Array.isArray(item.recentDoseOptions))
                        ? item.recentDoseOptions.reduce(function (options, option) {
                            if (!option || typeof option !== 'object') {
                                return options;
                            }

                            const hasValue = Object.prototype.hasOwnProperty.call(option, 'value');
                            const hasLabel = Object.prototype.hasOwnProperty.call(option, 'label');

                            if (!hasValue || !hasLabel) {
                                return options;
                            }

                            const value = option.value;
                            const label = option.label;

                            if ((value === null || value === undefined) || (label === null || label === undefined)) {
                                return options;
                            }

                            const valueString = String(value).trim();
                            const labelString = String(label).trim();

                            if (valueString === '' || labelString === '') {
                                return options;
                            }

                            options.push({
                                value: valueString,
                                label: labelString,
                            });

                            return options;
                        }, [])
                        : [];

                    return {
                        slug: slug,
                        label: (item && typeof item.label === 'string' && item.label.trim() !== '') ? item.label : 'the weight loss medication',
                        weight: item && typeof item.weight !== 'undefined' && item.weight !== null ? item.weight : '',
                        weight2: item && typeof item.weight2 !== 'undefined' && item.weight2 !== null ? item.weight2 : '',
                        unit: item && item.unit === 'st-lbs' ? 'st-lbs' : 'kg',
                        dose: item && typeof item.dose !== 'undefined' && item.dose !== null ? item.dose : '',
                        recentDose: item && typeof item.recentDose !== 'undefined' && item.recentDose !== null ? item.recentDose : '',
                        continueDose: item && typeof item.continueDose !== 'undefined' && item.continueDose !== null ? item.continueDose : '',
                        recentDoseOptions: recentDoseOptions
                    };
                });

                return window.__medicationStepData;
            };
        })();
    </script>
 <!--  <a href="/get-started/questionnaire?step=startagain" style="text-decoration: none;color: #000;" >Start again </a>-->

    <perch:if id="step" value="howold">
            <!-- ==========================================================================consultation section start ============================================================================================-->

            <section class="how_old">



                <div class="contanier">


                    <div class="are_you">

                        <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->



                        <div class="old_title">
                            <h2>How old are you?</h2>

                        </div>



                        <div class="under">
        <input type="radio" name="age" value="under18"  onclick="submitForm('age')"  id="Under"   <perch:if id="age" value="under18" required> checked="checked" </perch:if> />
                <label for="Under" id="UnderLabel">Under 18</label>

                <input type="radio" value="18to74"   onclick="submitForm('age')" name="age" id="18to74" <perch:if id="age" value="18to74"> checked="checked" </perch:if>>
                    <label for="18to74" id="18to74Lab">Older than 18 or Younger than 75 </label>

                    <input type="radio" value="75over"  onclick="submitForm('age')" name="age" id="over"  <perch:if id="age" value="75over"> checked="checked" </perch:if>>
                        <label for="over" id="18to74Labe">75 or over</label>
                            <input type="hidden" id="nextstep" name="nextstep" value="">

                        </div>







                        <div class="get_started">
                            <div class="started_button">
                                <div class="get_btn">
                                    <button><a href="/get-started">Back</a></button>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>



            </section>
        </perch:if>

        <perch:if id="step" value="under18,75over" match="within">


            <section class="under_18">
                <div class="container">
                    <main>
                        <div class="message-box">
                            <div class="icon">
                                &#10060;
                            </div>
                            <h2>No suitable treatment</h2>

                            <p>Our weight loss plan isn’t suitable for anyone younger than 18 or over 75. If you talk to your GP, they can discuss alternative plans to help you lose weight.</p>

                            <p><strong>Did you make a mistake in your consultation?</strong> Providing false information can lead to serious harm to your health.</p>
                            <button id="review-btn"><a href="/get-started/questionnaire?step=howold" style="text-decoration: none; color: #000;" >Review your answers</a></button>
                            <a href='<perch:forms id="previousPage"  />' class="homepage-link">Back to homepage</a>
                        </div>
                    </main>
                </div>
            </section>


        </perch:if>

        <perch:if id="step" value="18to74">

            <section class="how_old">
                <div class="contanier">
                    <div class="are_you">
                        <!--  <div class="progress_bar">
                       <div class="nambar">
                           <span>22%</span>
                       </div>

                   </div>-->
                        <div class="old_title">
                            <h2>Which ethnicity are you?</h2><br>


                            <h2>Healthy BMI ranges are different according to your ethnic background.</h2><br>


                            <h2>Our clinicians will carefully evaluate your BMI and complete medical history to determine the most appropriate treatment. This may include prescribing medications off-label when clinically appropriate.</h2>
                        </div>
                        <div class="under">
                            <input type="radio" name="ethnicity" value="asian"  onclick="submitForm('ethnicity')"  id="asian" required <perch:if id="ethnicity" value="asian"> checked="checked" </perch:if>>
                            <label for="asian" onclick="submitForm('ethnicity')"  id="asianlabel">Asian or Asian British</label>


                            <input type="radio" name="ethnicity" onclick="submitForm('ethnicity')" id="African" value="Black (African/Caribbean)" <perch:if id="ethnicity" value="Black (African/Caribbean)"> checked="checked" </perch:if>>
                            <label for="African" id="Africanlabel">Black (African/Caribbean)</label>


                            <input type="radio" name="ethnicity" onclick="submitForm('ethnicity')"  id="Mixed"  value="Mixed" <perch:if id="ethnicity" value="Mixed"> checked="checked" </perch:if>>
                            <label for="Mixed" id="Mixedlabel">Mixed ethnicities</label>

                            <input type="radio" name="ethnicity"onclick="submitForm('ethnicity')"  id="Other" value="Other" <perch:if id="ethnicity" value="Other"> checked="checked" </perch:if>>
                            <label for="Other" id="Otherlabel">Other ethnic group</label>


                            <input type="radio" name="ethnicity" onclick="submitForm('ethnicity')" id="White" value="White" <perch:if id="ethnicity" value="White"> checked="checked" </perch:if>>
                            <label for="White" id="Whitelabel">White</label>

                            <input type="hidden" id="nextstep" name="nextstep" value="">

                        </div>

                        <div class="get_started">
                            <div class="started_button">
                                <div class="get_btn">
                                    <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>


        </perch:if>
    <perch:if id="step" value="Other,Mixed" match="within">
        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                     <div class="nambar">
                         <span>22%</span>
                     </div>

                 </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="ethnicity-more">Please tell us which ethnicities.</label>
                    <textarea id="ethnicity-more"  name="ethnicity-more" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href="/get-started/questionnaire?step=18to74">Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="ethnicity">

                        <button type="submit" onclick="submitForm('ethnicity-more')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>
                    </div>
                </form>
            </div>
        </section>

    </perch:if>
    <perch:if id="step" value="ethnicity,asian,Black (African/Caribbean),White" match="within" >

        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2>What sex were you assigned at birth?</h2>
                    </div>


                    <div class="under">

                        <input type="radio" name="gender"  value="Male" required  onclick="submitForm('gender')"  id="Male" <perch:if id="gender" value="Male"> checked="checked" </perch:if>>
                        <label for="Male" id="Malelabel">Male</label>

                        <input type="radio" name="gender"  value="Female"    onclick="submitForm('gender')" id="Female" <perch:if id="gender" value="Female"> checked="checked" </perch:if>>
                        <label for="Female" id="Femalelabel">Female</label>
                        <input type="hidden" id="nextstep" name="nextstep" value="">

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>

                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </section>

    </perch:if>
    <perch:if id="step" value="Female">
    <section class="how_old">
        <div class="contanier">
            <div class="are_you">
                <!--  <div class="progress_bar">
                           <div class="nambar">
                               <span>22%</span>
                           </div>

                       </div>-->
                <div class="old_title">
                    <h2>Are you currently pregnant, trying to get pregnant, or breastfeeding?</h2>
                </div>


                <div class="under">

                    <div class="button-group">
                        <button id="yesBtn" onclick="setValuesForm('pregnancy','yes')" <perch:if id="pregnancy" value="yes"> class="custom_btn active" </perch:if> class="custom_btn "><span style="text-decoration: none; color: #000;" >Yes</span></button>
                        <button id="noBtn" onclick="setValuesForm('pregnancy','no')" <perch:if id="pregnancy" value="no"> class="custom_btn active" </perch:if> class="custom_btn"><span style="text-decoration: none; color: #000;" >No</span></button>
                        <input type="hidden" name="pregnancy" id="pregnancy"  />
                        <input type="hidden" id="nextstep" name="nextstep" value="">
                    </div>

                </div>
                <div class="get_started">
                    <div class="started_button">
                        <div class="get_btn">
                            <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>

                        </div>

                    </div>
                </div>

            </div>
        </div>
    </section>
    </perch:if>
    <perch:if id="step" value="pregnancy">


        <section class="under_18">
            <div class="container">
                <main>
                    <div class="message-box">
                        <div class="icon">
                            &#10060;
                        </div>
                        <h2>No suitable treatment</h2>

                        <p>Our weight loss plan isn’t suitable , they can discuss alternative plans to help you lose weight.</p>

                        <p><strong>Did you make a mistake in your consultation?</strong> Providing false information can lead to serious harm to your health.</p>
                        <button id="review-btn"><a href="/get-started/questionnaire?step=Female" style="text-decoration: none; color: #000;" >Review your answers</a></button>
                        <a href='<perch:forms id="previousPage"  />' class="homepage-link">Back to homepage</a>
                    </div>
                </main>
            </div>
        </section>


    </perch:if>
    <perch:if id="step" match="within" value="Male,weight">
        <section class="how_old">
            <div class="contanier">
                <div class="what_Is_your">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <h2>What is your weight?</h2>
                    <div class="weight-inputs">
                        <input type="number" id="weight"  required name="weight" placeholder="Kg" step="0.1" min="0">
                        <input type="hidden" id="weight2"  required name="weight2" placeholder="lbs" step="0.1" min="0">

                         <input type="hidden" id="weightunit" value="kg"   name="weightunit" >

                    </div>
                    <div class="unit-selector unit_selector">
                        <label><input type="radio" required onchange="radioweight(this.value)" name="weightradio-unit" id="weightradio-kg" value="kg" checked >kg</label>
                        <label><input type="radio" onchange="radioweight(this.value)" name="weightradio-unit"  id="weightradio-lbs" value="st-lbs"> st/lbs</label>
                    </div>
                    <div class="buttons">
                        <button class="back"><a href='<perch:forms id="previousPage"  />' style="text-decoration: none;color: #000;" >Back</a></button>

                        <input type="hidden" id="nextstep" name="nextstep" value="height">

                        <button onclick="submitForm('weight')"   class="next"><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>
                </div>

            </div>

        </section>
        <script>


            function radioweight(value) {

                const weight = document.getElementById("weight");

                document.getElementById("weightunit").value = document.querySelector('input[name=weightradio-unit]:checked').value;
                if (value === "kg") {
                    weight.placeholder = "Kg";
                    document.getElementById("weight2").type = "hidden";
                } else {
                    document.getElementById("weight2").type = "number";
                    weight.placeholder = "st";

                }
                /*  const weightkg = document.getElementById("weight");
                  const weightlbs = document.getElementById("weight-lbs");

                  if (value === "kg") {
                      weightlbs.style.display = "none";
                      weightkg.style.display = "flex";
                  } else {
                      weightlbs.style.display = "block";
                      weightkg.style.display = "none";
                  }*/

            }


        </script>
    </perch:if>
    <perch:if id="step" value="height">
        <section class="how_old">
        <div class="contanier">
                <div class="what_Is_your">
                    <!--  <div class="progress_bar">
                            <div class="nambar">
                                <span>22%</span>
                            </div>

                        </div>-->
                    <h2>What is your height?</h2>
                    <div class="weight-inputs">
                        <input type="number" id="height" name="height" required placeholder="Cm" step="0.1" min="0">
                        <input type="hidden" id="height2" name="height2" required placeholder="7.5"  step="0.1" min="0.5" max="12" required title="Enter your height in total inches">

                        <input type="hidden" id="heightunit" value="cm"   name="heightunit" >

                    </div>
                    <div class="unit-selector unit_selector">
                        <span id="spanheight">Cm</span>
                        <label><input type="radio" required onchange="radioheight(this.value)" name="heightunit-radio"  id="heightunit-radiocm" value="cm" checked >cm</label>
                        <label><input type="radio" onchange="radioheight(this.value)" name="heightunit-radio" id="heightunit-radio" value="ft-in"> ft/in</label>
                    </div>
                    <div class="buttons">
                        <button class="back"><a href='<perch:forms id="previousPage"  />' style="text-decoration: none;color: #000;" >Back</a></button>

                        <button onclick="submitForm('height')" class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="diabetes">
                    </div>
                </div>

            </div>

        </section>
        <script>
            const MIN_HEIGHT_CM = 89;
            const MAX_HEIGHT_CM = 272;
            const SHORT_HEIGHT_CONFIRMATION_THRESHOLD_CM = 100;

            function radioheight(value){

                const heightField = document.getElementById("height");
                const unitField = document.getElementById("heightunit");
                const unitLabel = document.getElementById("spanheight");
                const secondaryField = document.getElementById("height2");

                const selectedRadio = document.querySelector('input[name=heightunit-radio]:checked');
                if (selectedRadio && unitField) {
                    unitField.value = selectedRadio.value;
                }

                if (unitLabel) {
                    unitLabel.innerHTML = value;
                }

                if (!heightField || !secondaryField) {
                    return;
                }

                if (value === "cm") {
                    heightField.placeholder = "Cm";
                    heightField.type = "number";
                    secondaryField.type = "hidden";
                    secondaryField.required = false;
                    secondaryField.value = "";
                }else{
                    heightField.type = "number";
                    secondaryField.type = "number";
                    heightField.placeholder = "Ft";
                    secondaryField.required = false;
                    secondaryField.placeholder = "In";

                }

            }

            window.addEventListener('DOMContentLoaded', function () {
                const form = document.getElementById('questionnaire');
                if (!form) {
                    return;
                }

                const parseNumeric = (rawValue) => {
                    if (typeof rawValue !== 'string') {
                        return null;
                    }

                    const normalised = rawValue.replace(',', '.').trim();
                    if (normalised === '') {
                        return null;
                    }

                    const numericValue = parseFloat(normalised);
                    return Number.isFinite(numericValue) ? numericValue : null;
                };

                const toCentimetres = (primaryValue, secondaryValue, unit) => {
                    const primary = parseNumeric(primaryValue);
                    if (primary === null || primary <= 0) {
                        return null;
                    }

                    if (unit === 'cm') {
                        return primary;
                    }

                    if (unit === 'ft-in') {
                        const secondaryParsed = parseNumeric(secondaryValue);
                        const secondary = secondaryParsed === null ? 0 : secondaryParsed;
                        if (secondary < 0 || secondary >= 12) {
                            return null;
                        }
                        const totalInches = (primary * 12) + secondary;
                        return totalInches * 2.54;
                    }

                    if (unit === 'in') {
                        return primary * 2.54;
                    }

                    return null;
                };

                const formatHeightRangeForUnit = (unit) => {
                    if (unit === 'ft-in') {
                        const format = (cm) => {
                            const totalInches = cm / 2.54;
                            let feet = Math.floor(totalInches / 12);
                            let inches = Math.round(totalInches - (feet * 12));

                            if (inches === 12) {
                                feet += 1;
                                inches = 0;
                            }

                            return `${feet} ft ${inches} in`;
                        };

                        return `${format(MIN_HEIGHT_CM)} and ${format(MAX_HEIGHT_CM)}`;
                    }

                    if (unit === 'in') {
                        const toInches = (cm) => (cm / 2.54).toFixed(1);
                        return `${toInches(MIN_HEIGHT_CM)} in and ${toInches(MAX_HEIGHT_CM)} in`;
                    }

                    return `${MIN_HEIGHT_CM} cm and ${MAX_HEIGHT_CM} cm`;
                };

                const focusField = (field) => {
                    if (field && typeof field.focus === 'function') {
                        field.focus();
                    }
                };

                const originalSubmitForm = window.submitForm;

                window.submitForm = function (nextStep) {
                    if (nextStep === 'height') {
                        const unitRadio = document.querySelector('input[name="heightunit-radio"]:checked');
                        const unitField = document.getElementById('heightunit');
                        const primaryField = document.getElementById('height');
                        const secondaryField = document.getElementById('height2');

                        let unit = 'cm';
                        if (unitRadio && unitRadio.value) {
                            unit = unitRadio.value;
                        } else if (unitField && unitField.value) {
                            unit = unitField.value;
                        }

                        if (unitField && unitRadio && unitRadio.value) {
                            unitField.value = unitRadio.value;
                        }

                        const primaryRawValue = primaryField ? primaryField.value : '';
                        const primaryNumeric = parseNumeric(primaryRawValue);

                        if (primaryNumeric === null || primaryNumeric <= 0) {
                            window.alert('Please enter your height using numbers greater than zero.');
                            focusField(primaryField);
                            return false;
                        }

                        let secondaryValue = secondaryField ? secondaryField.value : '';
                        if (unit === 'ft-in') {
                            const secondaryNumeric = parseNumeric(secondaryValue);
                            if (secondaryNumeric === null) {
                                secondaryValue = '0';
                            } else if (secondaryNumeric < 0 || secondaryNumeric >= 12) {
                                window.alert('Please enter the inches part of your height as a number between 0 and 11.9.');
                                focusField(secondaryField);
                                return false;
                            } else {
                                secondaryValue = String(secondaryNumeric);
                            }
                        }

                        const heightInCm = toCentimetres(
                            String(primaryNumeric),
                            secondaryValue,
                            unit
                        );

                        if (heightInCm === null) {
                            const rangeDescription = formatHeightRangeForUnit(unit);
                            window.alert(`Please enter a valid height between ${rangeDescription}. The shortest adult in the UK is 89 cm.`);
                            focusField(primaryField);
                            return false;
                        }

                        if (heightInCm < MIN_HEIGHT_CM || heightInCm > MAX_HEIGHT_CM) {
                            const rangeDescription = formatHeightRangeForUnit(unit);
                            window.alert(`Please enter a realistic height between ${rangeDescription}. The shortest adult in the UK is 89 cm.`);
                            focusField(primaryField);
                            return false;
                        }

                        if (heightInCm < SHORT_HEIGHT_CONFIRMATION_THRESHOLD_CM) {
                            const confirmationMessage = `You entered ${heightInCm.toFixed(1)} cm. The shortest adult in the UK is 89 cm. Please confirm that your height is correct before continuing.`;
                            const confirmed = window.confirm(confirmationMessage);
                            if (!confirmed) {
                                focusField(primaryField);
                                return false;
                            }
                        }
                    }

                    if (typeof originalSubmitForm === 'function') {
                        return originalSubmitForm(nextStep);
                    }

                    const nextStepField = document.getElementById('nextstep');
                    if (nextStepField) {
                        nextStepField.value = nextStep;
                    }

                    if (typeof form.requestSubmit === 'function') {
                        form.requestSubmit();
                    } else {
                        form.submit();
                    }

                    return false;
                };
            });
        </script>
    </perch:if>

    <perch:if id="step" value="diabetes">

        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2>Have you been diagnosed with diabetes?</h2><br>


                        <h2>Diabetes treatments can impact the way the medication included with our weight loss plan works.
                        </h2><br>


                    </div>
                    <div class="under">
                        <input type="radio" name="diabetes" required onclick="submitForm('diabetes')"  <perch:if id="diabetes" value="yes-medication"> checked </perch:if>   value="yes-medication" id="yes-medication" checked="checked">
                        <label for="yes-medication" id="have">I have diabetes and take medication for it</label>


                        <input type="radio" name="diabetes" value="yes-diet" <perch:if id="diabetes" value="yes-diet"> checked </perch:if>   onclick="submitForm('diabetes')" id="yes-diet">
                        <label for="yes-diet" >I have diabetes and it's diet-controlled</label>


                        <input type="radio" name="diabetes" id="nohistory" onclick="submitForm('diabetes')" <perch:if id="diabetes" value="nohistory"> checked </perch:if>   value="nohistory">
                        <label for="nohistory" id="there">No, but there is history of diabetes in my family</label>

                        <input type="radio" value="pre-diabetes"  <perch:if id="diabetes" value="pre-diabetes"> checked </perch:if>  id="pre-diabetes" onclick="submitForm('diabetes')" name="diabetes" id="Other">
                        <label for="pre-diabetes" >I have pre-diabetes</label>


                        <input type="radio" name="diabetes" id="no"  <perch:if id="diabetes" value="no"> checked </perch:if>   value="no" onclick="submitForm('diabetes')">
                        <label for="no" >I don't have diabetes</label>
                        <input type="hidden" id="nextstep" name="nextstep" value="weight2">



                    </div>

                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
        <script>
            (function () {
                const container = document.getElementById('medication-continue-dose-fields');

                if (!container) {
                    return;
                }

                const escapeHtml = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value)
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                };

                const normalizeValue = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value).trim().toLowerCase();
                };

                const toIdSuffix = function (value, fallbackIndex) {
                    const normalized = normalizeValue(value)
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/^-+|-+$/g, '');

                    if (normalized !== '') {
                        return normalized;
                    }

                    return String(fallbackIndex);
                };

                const medicationConfigs = window.getMedicationStepData();
                const options = [
                    { value: 'increase', label: 'Increase my dose' },
                    { value: 'keep', label: 'Keep my dose' },
                    { value: 'decrease', label: 'Decrease my dose' },
                    { value: 'not-continue', label: "I don't want to continue with this medication" }
                ];

                medicationConfigs.forEach(function (config, index) {
                    const slug = config.slug || `medication-${index + 1}`;
                    const label = config.label || 'the weight loss medication';
                    const storedValue = typeof config.continueDose === 'string' ? config.continueDose : '';
                    const normalizedStoredValue = normalizeValue(storedValue);

                    let fieldHtml = `
                        <div class="medication-continue-dose" data-medication="${escapeHtml(label)}">
                            <div class="old_title">
                                <h3 class="medication-subtitle">${escapeHtml(label)}</h3>
                            </div>
                            <div class="under">
                    `;

                    options.forEach(function (option, optionIndex) {
                        const optionValue = option.value;
                        const optionLabel = option.label;
                        const normalizedOptionValue = normalizeValue(optionValue);
                        const isChecked = normalizedStoredValue !== ''
                            ? normalizedStoredValue === normalizedOptionValue
                            : optionIndex === 0;
                        const requiredAttr = optionIndex === 0 ? ' required' : '';
                        const inputId = `continue-dose-${slug}-${toIdSuffix(optionValue, optionIndex)}`;

                        fieldHtml += `
                                <input type="radio" value="${escapeHtml(optionValue)}" id="${escapeHtml(inputId)}" name="continue-dose-${escapeHtml(slug)}"${requiredAttr}${isChecked ? ' checked' : ''} onclick="submitForm('continue-dose-${slug}')">
                                <label for="${escapeHtml(inputId)}">${escapeHtml(optionLabel)}</label>
                        `;
                    });

                    fieldHtml += `
                            </div>
                        </div>
                    `;

                    container.insertAdjacentHTML('beforeend', fieldHtml);
                });
            })();
        </script>
    </perch:if>


    <perch:if id="step" value="weight2">
        <section class="statements_apply">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="statement_content">
                            <div class="top_contents">
                               <!-- <div class="progress_bar">
                                    <p class="Percent_text">14%</p><span class="bar_line"></span>
                                </div>-->
                                <h5>Do any of the following statements apply to you?</h5>
                                <h5>
                                    These conditions can lead to serious complications when losing weight or taking weight loss medications.
                                </h5>
                            </div>
                            <!--////////////========chekbox section start=======/////////////-->
                            <div class="box_group mt-2">
                                <div class="box_list" id="fullBox">
                                    <input type="checkbox" name="conditions[]"  <perch:if id="conditions" value="malabsorption"> checked </perch:if>   class="check1" value="malabsorption" onclick="changeColor()">
                                    <span class="box_text">I have chronic malabsorption syndrome (problems absorbing food)</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox2">
                                    <input type="checkbox" name="conditions[]" value="cholestasis" <perch:if id="conditions" value="cholestasis"> checked </perch:if>  class="check1" onclick="changeColor2()">
                                    <span class="box_text">I have cholestasis</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox3">
                                    <input type="checkbox" name="conditions[]" value="cancer" <perch:if id="conditions" value="cancer"> checked </perch:if>  class="check1" onclick="changeColor3()">
                                    <span class="box_text">I’m currently being treated for cancer</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox4">
                                    <input type="checkbox" name="conditions[]" value="retinopathy"  <perch:if id="conditions" value="retinopathy"> checked </perch:if>   class="check1" onclick="changeColor4()">
                                    <span class="box_text">I have diabetic retinopathy</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox5">
                                    <input type="checkbox" name="conditions[]" value="heartfailure" <perch:if id="conditions" value="heartfailure"> checked </perch:if>  class="check1" onclick="changeColor5()">
                                    <span class="box_text">I have severe heart failure</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox6">
                                    <input type="checkbox" name="conditions[]" value="familythyroid" <perch:if id="conditions" value="familythyroid"> checked </perch:if>  class="check1" onclick="changeColor6()">
                                    <span class="box_text">I have a family history of thyroid cancer and/or I’ve had thyroid cancer</span>
                                </div>




                                <div class="box_list mt-2" id="fullBox7">
                                    <input type="checkbox" name="conditions[]" value="neoplasia" <perch:if id="conditions" value="neoplasia"> checked </perch:if>  class="check1" onclick="changeColor7()">
                                    <span class="box_text">I have Multiple endocrine neoplasia type 2 (MEN2)</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox8">
                                    <input type="checkbox" name="conditions[]" value="pancreatitishistory" <perch:if id="conditions" value="pancreatitishistory"> checked </perch:if>  class="check1" onclick="changeColor8()">
                                    <span class="box_text">I have a history of pancreatitis</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox9">
                                    <input type="checkbox" name="conditions[]" value="eatingdisorder" <perch:if id="conditions" value="eatingdisorder"> checked </perch:if>  class="check1" onclick="changeColor9()">
                                    <span class="box_text">I have or have had an eating disorder such as bulimia, anorexia nervosa, or a binge eating disorder</span>
                                </div>




                                <div class="box_list mt-2" id="fullBox10">
                                    <input type="checkbox" name="conditions[]" value="thyroidoperation" <perch:if id="conditions" value="thyroidoperation"> checked </perch:if>  class="check1" onclick="changeColor10()">
                                    <span class="box_text">I have had surgery or an operation to my thyroid</span>
                                </div>


                                <div class="box_list mt-2" id="fullBox11">
                                    <input type="checkbox"  name="conditions[]" value="bariatricoperation" <perch:if id="conditions" value="bariatricoperation"> checked </perch:if>  class="check1" onclick="changeColor11()">
                                    <span class="box_text">I have had a bariatric operation such as gastric band or sleeve surgery</span>
                                </div>



                                <br>



                                <div class="box_list mt-2 mb-5" id="fullBox12">
                                    <input type="checkbox" name="conditions[]" value="none" class="check1" <perch:if id="conditions" value="none"> checked </perch:if>  onclick="changeColor12()">
                                    <span class="box_text">None of these statements apply to me</span>
                                </div>
                            </div>
                            <!--////////////========chekbox section END=======/////////////-->

                            <!--////////////========Button section Start=======/////////////-->
                            <div class="bottom_btn mt-5">
                                <input type="hidden" id="nextstep" name="nextstep" value="conditions">

                                <button class="btn_back"><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                                <button id="nextButton"  onclick="submitForm('conditions')" class="btn_next" disabled><span>Next <i class="fa-solid fa-arrow-right"></i></span></button>
                            </div>
                            <!--////////////========Button section END=======/////////////-->

                        </div>
                    </div>
                </div>
            </div>
        </section>


    </perch:if>

    <perch:if id="step" value="bariatricoperation">
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                            <div class="nambar">
                                <span>22%</span>
                            </div>

                        </div>-->
                    <div class="old_title">
                        <h2>Was your bariatric operation in the last 6 months? </h2>
                    </div>


                    <div class="unde">

                        <div class="button-group">

                            <button id="yesBtn" onclick="setValuesForm('bariatricoperation','yes')"  class="custom_btn"><span style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesForm('bariatricoperation','no')" class="custom_btn"><span style="text-decoration: none; color: #000;" >No</span></button>
                            <input type="hidden" id="bariatricoperation" name="bariatricoperation" value="">

                            <input type="hidden" id="nextstep" name="nextstep" value="">
                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </perch:if>
    <perch:if id="step" value="history_pancreatitis">
        <section class="under_18">
            <div class="container">
                <main>
                    <div class="message-box">
                        <div class="icon">
                            &#10060;
                        </div>
                        <h2>No suitable treatment</h2>

                        <p>Based on your medical history, your weight loss is best managed by your GP and we can’t recommend our weight loss plan for you.</p>

                        <p><strong>Did you make a mistake in your consultation?</strong> Providing false information can lead to serious harm to your health.</p>
                        <button id="review-btn"><a href="/get-started/questionnaire?step=howold" style="text-decoration: none; color: #000;" >Review your answers</a></button>
                        <a href='<perch:forms id="previousPage"  />' class="homepage-link">Back to homepage</a>
                    </div>
                </main>
            </div>
        </section>

    </perch:if>
    <perch:if id="step" value="more_pancreatitis">
        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                  <!--  <div class="progress_bar">
                        <div class="nambar">
                            <span>22%</span>
                        </div>

                    </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="more_pancreatitis">Please tell us more about your health condition and how you manage it.</label>
                    <textarea id="more_pancreatitis" required name="more_pancreatitis" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href='<perch:forms id="previousPage"  />'>Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="conditions">
                       <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                        <button type="submit" onclick="submitForm('more_pancreatitis')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>

                    </div>
                </form>
            </div>
        </section>
    </perch:if>
    <perch:if id="step" value="thyroidoperation">
        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                     <div class="nambar">
                         <span>22%</span>
                     </div>

                 </div>-->
                </div>
                <form id="thyroidoperation">
                    <label for="thyroidoperation">Please tell us further details on the thyroid surgery you had, the outcome of the surgery and any ongoing monitoring</label>
                    <textarea id="thyroidoperation" required name="thyroidoperation" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href='<perch:forms id="previousPage"  />'>Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="conditions">
                       <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                        <button type="submit" onclick="submitForm('thyroidoperation')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>

                    </div>
                </form>
            </div>
        </section>

    </perch:if>

    <perch:if id="step" value="more">
        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                     <div class="nambar">
                         <span>22%</span>
                     </div>

                 </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="more_conditions">Please tell us more about your health condition and how you manage it.</label>
                    <textarea id="more_conditions" required name="more_conditions" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href='<perch:forms id="previousPage"  />'>Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="medical_conditions">
                       <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                        <button type="submit" onclick="submitForm('more_conditions')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>

                    </div>
                </form>
            </div>
        </section>
    </perch:if>
    <perch:if id="step" value="conditions">
        <section class="statements_apply">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="statement_content">
                            <div class="top_contents">
                               <!-- <div class="progress_bar">
                                    <p class="Percent_text">20%</p><span class="bar_line"></span>
                                </div>-->
                                <h5>Do any of the following statements apply to you?</h5>
                                <h5>
                                    These conditions are often weight related and may be improved as a result of losing weight.
                                </h5>
                            </div>
                            <!--////////////========chekbox section start=======/////////////-->
                            <div class="box_group mt-2">
                                <div class="box_list" id="fullBox">
                                    <input type="checkbox" name="conditions2[]" value="mentalhealth" class="check1" onclick="changeColor()">
                                    <span class="box_text">I have been diagnosed with a mental health condition such as depression or anxiety </span>
                                </div>
                                <div class="box_list mt-2" id="fullBox2">
                                    <input type="checkbox" name="conditions2[]" value="anxious" class="check1" onclick="changeColor2()">
                                    <span class="box_text">My weight makes me anxious in social situations</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox3">
                                    <input type="checkbox" name="conditions2[]" value="joint" class="check1" onclick="changeColor3()">
                                    <span class="box_text">I have joint pains and/or aches</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox4">
                                    <input type="checkbox"  name="conditions2[]" value="osteoarthritis" class="check1" onclick="changeColor4()">
                                    <span class="box_text">I have osteoarthritis</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox5">
                                    <input type="checkbox" name="conditions2[]" value="indigestion" class="check1" onclick="changeColor5()">
                                    <span class="box_text">I have GORD and/or indigestion</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox6">
                                    <input type="checkbox" name="conditions2[]" value="cardiovascular" class="check1" onclick="changeColor6()">
                                    <span class="box_text">I have a heart/cardiovascular problem</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox7">
                                    <input type="checkbox" name="conditions2[]" value="bloodpressure"  class="check1" onclick="changeColor7()">
                                    <span class="box_text">I’ve been diagnosed with, or have a family history of, high blood pressure</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox8">
                                    <input type="checkbox" name="conditions2[]" value="cholesterol"  class="check1" onclick="changeColor8()">
                                    <span class="box_text">I’ve been diagnosed with, or have a family history of, high cholesterol</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox9">
                                    <input type="checkbox" name="conditions2[]" value="fattyliver" class="check1" onclick="changeColor9()">
                                    <span class="box_text">I have fatty liver disease</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox10">
                                    <input type="checkbox" name="conditions2[]" value="apnoea"  class="check1" onclick="changeColor10()">
                                    <span class="box_text">I have sleep apnoea</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox11">
                                    <input type="checkbox" name="conditions2[]" value="asthma"  class="check1" onclick="changeColor11()">
                                    <span class="box_text">I have asthma or COPD</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox12">
                                    <input type="checkbox" name="conditions2[]" value="erectile" class="check1" onclick="changeColor12()">
                                    <span class="box_text">I have erectile dysfunction</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox13">
                                    <input type="checkbox" name="conditions2[]" value="testosterone" class="check1" onclick="changeColor13()">
                                    <span class="box_text">I have low testosterone</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox14">
                                    <input type="checkbox" name="conditions2[]" value="menopausal" class="check1" onclick="changeColor14()">
                                    <span class="box_text">I have menopausal symptoms</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox15">
                                    <input type="checkbox" name="conditions2[]" value="pcos" class="check1" onclick="changeColor15()">
                                    <span class="box_text">I have polycystic ovary syndrome (PCOS)</span>
                                </div>
                                <hr>
                                <div class="box_list mt-2" id="fullBox16">
                                    <input type="checkbox" name="conditions2[]" value="none" class="check1" onclick="changeColor16()">
                                    <span class="box_text">None of these statements apply to me</span>
                                </div>
                            </div>
                            <!--////////////========chekbox section END=======/////////////-->

                            <!--////////////========Button section Start=======/////////////-->
                            <div class="bottom_btn mt-5">
                                <input type="hidden" id="nextstep" name="nextstep" value="medical_conditions">

                                <button class="btn_back"><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                                <button id="nextButton" onclick="submitForm('conditions')" class="btn_next" disabled><span>Next <i class="fa-solid fa-arrow-right"></i></span></button>
                            </div>
                            <!--////////////========Button section END=======/////////////-->

                        </div>
                    </div>
                </div>
            </div>
        </section>

    </perch:if>
    <perch:if id="step" value="medical_conditions">

        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2>Do you have any other medical conditions?</h2>
                        <br>
                        <h2>Our clinicians need to know your full medical history to make sure our weight loss plan is safe for you. </h2>
                    </div>


                    <div class="unde">

                        <div class="button-group">
                            <button id="yesBtn" onclick="setValuesForm('medical_conditions','yes')"  class="custom_btn"><span style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesForm('medical_conditions','no')" class="custom_btn"><span style="text-decoration: none; color: #000;" >No</span></button>

                            <input type="hidden" id="medical_conditions" name="medical_conditions" value="">

                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <input type="hidden" id="nextstep" name="nextstep" value="">
                                <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

    </perch:if>
    <perch:if id="step" value="medications">
        <section class="statements_apply">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="statement_content">
                            <div class="top_contents">
                               <!-- <div class="progress_bar">
                                    <p class="Percent_text">26%</p><span class="bar_line"></span>
                                </div>-->
                                <h5>
                                    Have you ever taken any of the following medications to help you lose weight?
                                </h5>
                            </div>
                            <!--////////////========chekbox section start=======/////////////-->
                            <div class="box_group mt-2">
                                <div class="box_list" id="fullBox">
                                    <input type="checkbox" name="medications[]" value="wegovy" class="check1" onclick="changeColor()">
                                    <span class="box_text">Wegovy</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox2">
                                    <input type="checkbox" name="medications[]" value="ozempic" class="check1" onclick="changeColor2()">
                                    <span class="box_text">Ozempic</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox3">
                                    <input type="checkbox" name="medications[]" value="saxenda" class="check1" onclick="changeColor3()">
                                    <span class="box_text">Saxenda</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox4">
                                    <input type="checkbox" name="medications[]" value="rybelsus" class="check1" onclick="changeColor4()">
                                    <span class="box_text">Rybelsus</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox5">
                                    <input type="checkbox" name="medications[]" value="mounjaro" class="check1" onclick="changeColor5()">
                                    <span class="box_text">Mounjaro</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox6">
                                    <input type="checkbox" name="medications[]" value="alli" class="check1" onclick="changeColor6()">
                                    <span class="box_text">Alli</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox7">
                                    <input type="checkbox" name="medications[]" value="mysimba" class="check1" onclick="changeColor7()">
                                    <span class="box_text">Mysimba</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox8">
                                    <input type="checkbox" name="medications[]" value="other" class="check1" onclick="changeColor8()">
                                    <span class="box_text">Other</span>
                                </div>
                                <hr>
                                <div class="box_list mt-2" id="fullBox9">
                                    <input type="checkbox" name="medications[]" value="none"  class="check1" onclick="changeColor9()">
                                    <span class="box_text">I have never taken medication to lose weight</span>
                                </div>
                            </div>
                            <!--////////////========chekbox section END=======/////////////-->

                            <!--////////////========Button section Start=======/////////////-->
                            <div class="bottom_btn mt-5">
                                <input type="hidden" id="nextstep" name="nextstep" value="medication_allergies">

                                <button class="btn_back"><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                                <button id="nextButton" class="btn_next" disabled><span>Next <i class="fa-solid fa-arrow-right"></i></span></button>
                            </div>
                            <!--////////////========Button section END=======/////////////-->

                        </div>
                    </div>
                </div>
            </div>
        </section>


    </perch:if>
    <perch:if id="step" value="starting_wegovy" >
        <section class="how_old">
            <div class="contanier">
                <div class="what_Is_your">
                    <!--  <div class="progress_bar">
                       <div class="nambar">
                           <span>22%</span>
                       </div>

                   </div>-->
                    <div id="medication-weight-fields"></div>

                  <!--  <div class="buttons skip ">
                        <button class="back skip_button "><a href="/get-started/questionnaire?step=dose_wegovy" style="text-decoration: none;color: #000;" >Skip</a></button>
                    </div>-->


                    <div class="buttons">
                        <input type="hidden" id="nextstep" name="nextstep" value="dose_wegovy">

                        <button class="back"><a href='<perch:forms id="previousPage"  />' style="text-decoration: none;color: #000;" >Back</a></button>
                       <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                        <button id="medication-weight-next" onclick="submitForm('weight-wegovy')" class="next"><span  style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>
                </div>

            </div>

        </section>
        <script>
            (function () {
                const container = document.getElementById('medication-weight-fields');
                const nextButton = document.getElementById('medication-weight-next');

                if (!container) {
                    return;
                }

                const escapeHtml = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value)
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                };

                const medicationWeights = window.getMedicationStepData();

                medicationWeights.forEach(function (config, index) {
                    const slug = config.slug || `medication-${index + 1}`;
                    const unit = config.unit === 'st-lbs' ? 'st-lbs' : 'kg';
                    const placeholder = unit === 'kg' ? 'Kg' : 'St';
                    const weight2Type = unit === 'st-lbs' ? 'number' : 'hidden';
                    const label = config.label || 'the weight loss medication';

                    const fieldHtml = `
                        <div class="medication-weight" data-medication="${escapeHtml(label)}">
                            <h2>What was your weight in kg/st-lbs before starting <span class="medication-name">${escapeHtml(label)}</span>?</h2>
                            <div class="weight-inputs">
                                <input type="number" name="weight-${slug}" id="weight-${slug}" placeholder="${placeholder}" value="${escapeHtml(config.weight)}" step="0.1" min="0">
                                <input type="${weight2Type}" id="weight2-${slug}" name="weight2-${slug}" placeholder="lbs" value="${escapeHtml(config.weight2)}" step="0.1" min="0" />
                                <input type="hidden" id="unit-${slug}" value="${unit}" name="unit-${slug}">
                                <div class="st_lbs" id="st-lbs-inputs-${slug}" style="display: none;">
                                    <input type="number" placeholder="St" step="0.1" min="0">
                                    <input type="number" placeholder="Lbs" step="0.1" min="0">
                                </div>
                            </div>
                            <div class="unit-selector unit_selector">
                                <label><input type="radio" onchange="radioweightMedication(this.value, '${slug}')" name="unit-${slug}radio" value="kg" ${unit === 'kg' ? 'checked' : ''}>kg</label>
                                <label><input type="radio" onchange="radioweightMedication(this.value, '${slug}')" name="unit-${slug}radio" value="st-lbs" ${unit === 'st-lbs' ? 'checked' : ''}> st/lbs</label>
                            </div>
                        </div>
                    `;

                    container.insertAdjacentHTML('beforeend', fieldHtml);

                    if (index === 0 && nextButton) {
                        nextButton.setAttribute('onclick', `submitForm('weight-${slug}')`);
                    }
                });
            })();

            function radioweightMedication(value, slug) {
                const weight = document.getElementById(`weight-${slug}`);
                const weight2 = document.getElementById(`weight2-${slug}`);
                const unitInput = document.getElementById(`unit-${slug}`);

                if (!weight || !weight2 || !unitInput) {
                    return;
                }

                unitInput.value = value;

                if (value === 'kg') {
                    weight.placeholder = 'Kg';
                    weight2.type = 'hidden';
                } else {
                    weight.placeholder = 'St';
                    weight2.type = 'number';
                    weight2.placeholder = 'lbs';
                }
            }
        </script>
    </perch:if>
    <perch:if id="step" value="dose_wegovy" >
        <section class="how_old">



            <div class="contanier">


                <div class="are_you">

                    <!--  <div class="progress_bar">
                        <div class="nambar">
                            <span>22%</span>
                        </div>

                    </div>-->

                    <div id="medication-dose-fields"></div>

                    <div class="buttons">
                        <input type="hidden" id="nextstep" name="nextstep" value="recently_wegovy">

                        <button class="back"><a href='<perch:forms id="previousPage"  />'>Back</a></button>

                        <button id="medication-dose-next" class="next" onclick="submitForm('dose-wegovy')"><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>

                </div>

            </div>



        </section>
        <script>
            (function () {
                const container = document.getElementById('medication-dose-fields');
                const nextButton = document.getElementById('medication-dose-next');

                if (!container) {
                    return;
                }

                const escapeHtml = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value)
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                };

                const options = [
                    { value: 'less4', label: 'Less than 4 weeks ago' },
                    { value: '4to6', label: '4-6 weeks ago' },
                    { value: 'over6', label: 'More than 6 weeks ago' }
                ];

                const medicationConfigs = window.getMedicationStepData();

                medicationConfigs.forEach(function (config, index) {
                    const slug = config.slug || `medication-${index + 1}`;
                    const label = config.label || 'the weight loss medication';
                    const hasExistingValue = typeof config.dose === 'string' && config.dose !== '';

                    let fieldHtml = `
                        <div class="medication-dose" data-medication="${escapeHtml(label)}">
                            <div class="old_title">
                                <h2>When was your last dose of <span class="medication-name">${escapeHtml(label)}</span>?</h2>
                            </div>
                            <div class="under">
                    `;

                    options.forEach(function (option, optionIndex) {
                        const isChecked = hasExistingValue ? config.dose === option.value : optionIndex === 0;
                        const requiredAttr = optionIndex === 0 ? ' required' : '';
                        const inputId = `dose-${slug}-${option.value}`;
                        fieldHtml += `
                                <input type="radio" value="${option.value}" id="${inputId}" name="dose-${slug}"${requiredAttr}${isChecked ? ' checked' : ''}>
                                <label for="${inputId}">${escapeHtml(option.label)}</label>
                        `;
                    });

                    fieldHtml += `
                            </div>
                        </div>
                    `;

                    container.insertAdjacentHTML('beforeend', fieldHtml);

                    if (index === 0 && nextButton) {
                        nextButton.setAttribute('onclick', `submitForm('dose-${slug}')`);
                    }
                });
            })();
        </script>
    </perch:if>
    <perch:if id="step" value="recently_wegovy" >
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                     <div class="nambar">
                         <span>22%</span>
                     </div>

                 </div>-->
                    <div id="medication-recent-dose-fields"></div>

                    <div class="buttons">
                        <input type="hidden" id="nextstep" name="nextstep" value="continue_with_wegovy">

                        <button class="back"><a href='<perch:forms id="previousPage"  />'>Back</a></button>

                        <button id="medication-recent-dose-next" class="next" onclick="submitForm('recently-dose-wegovy')"><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>

                </div>
            </div>
        </section>
        <script>
            (function () {
                const container = document.getElementById('medication-recent-dose-fields');
                const nextButton = document.getElementById('medication-recent-dose-next');

                if (!container) {
                    return;
                }

                const escapeHtml = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value)
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                };

                const normalizeValue = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value).trim().toLowerCase();
                };

                const toIdSuffix = function (value, fallbackIndex) {
                    const normalized = normalizeValue(value)
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/^-+|-+$/g, '');

                    if (normalized !== '') {
                        return normalized;
                    }

                    return String(fallbackIndex);
                };

                const medicationConfigs = window.getMedicationStepData();

                medicationConfigs.forEach(function (config, index) {
                    const slug = config.slug || `medication-${index + 1}`;
                    const label = config.label || 'the weight loss medication';
                    const storedRecentDose = typeof config.recentDose === 'string' ? config.recentDose : '';
                    const recentDoseOptions = Array.isArray(config.recentDoseOptions) ? config.recentDoseOptions : [];
                    const hasRadioOptions = recentDoseOptions.length > 0;

                    let fieldHtml = `
                        <div class="medication-recent-dose" data-medication="${escapeHtml(label)}">
                            <div class="old_title">
                                <h2>What dose of <span class="medication-name">${escapeHtml(label)}</span> were you prescribed most recently?</h2>
                            </div>
                            <div class="under">
                    `;

                    if (hasRadioOptions) {
                        const normalizedStoredValue = normalizeValue(storedRecentDose);

                        recentDoseOptions.forEach(function (option, optionIndex) {
                            if (!option || typeof option.value === 'undefined' || typeof option.label === 'undefined') {
                                return;
                            }

                            const optionValue = option.value;
                            const optionLabel = option.label;
                            const normalizedOptionValue = normalizeValue(optionValue);
                            const isChecked = normalizedStoredValue !== ''
                                ? normalizedStoredValue === normalizedOptionValue
                                : optionIndex === 0;
                            const requiredAttr = optionIndex === 0 ? ' required' : '';
                            const inputId = `recently-dose-${slug}-${toIdSuffix(optionValue, optionIndex)}`;

                            fieldHtml += `
                                <input type="radio" value="${escapeHtml(optionValue)}" id="${escapeHtml(inputId)}" name="recently-dose-${slug}"${requiredAttr}${isChecked ? ' checked' : ''}>
                                <label for="${escapeHtml(inputId)}">${escapeHtml(optionLabel)}</label>
                            `;
                        });
                    } else {
                        const inputId = `recently-dose-${slug}`;
                        fieldHtml += `
                                <input type="text" id="${escapeHtml(inputId)}" name="recently-dose-${slug}" value="${escapeHtml(storedRecentDose)}" required placeholder="Enter your most recent dose">
                        `;
                    }

                    fieldHtml += `
                            </div>
                        </div>
                    `;

                    container.insertAdjacentHTML('beforeend', fieldHtml);

                    if (index === 0 && nextButton) {
                        nextButton.setAttribute('onclick', `submitForm('recently-dose-${slug}')`);
                    }
                });
            })();
        </script>

    </perch:if>
    <perch:if id="step" value="continue_with_wegovy">

        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2>If you want to continue with <span id="medication">the weight loss medication</span>, what dose would you like to continue with? </h2><br>


                        <p style="font-weight: 500;" > <strong>A</strong> clinician will review your answers and select your dosage as appropriate. Price varies by dosage. </p>


                    </div>
                    <div class="under">
                        <div id="medication-continue-dose-fields"></div>
                        <input type="hidden" id="nextstep" name="nextstep" value="effects_with_wegovy">
                    </div>

                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                                <button id="medication-continue-dose-next" class="next"><span style="text-decoration: none;color: #000;" >Next →</span></button>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
        <script>
            (function () {
                const container = document.getElementById('medication-continue-dose-fields');
                const nextButton = document.getElementById('medication-continue-dose-next');

                if (!container) {
                    return;
                }

                const escapeHtml = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value)
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                };

                const normalizeValue = function (value) {
                    if (value === null || value === undefined) {
                        return '';
                    }

                    return String(value).trim().toLowerCase();
                };

                const toIdSuffix = function (value, fallbackIndex) {
                    const normalized = normalizeValue(value)
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/^-+|-+$/g, '');

                    if (normalized !== '') {
                        return normalized;
                    }

                    return String(fallbackIndex);
                };

                const medicationConfigs = window.getMedicationStepData();
                const options = [
                    { value: 'increase', label: 'Increase my dose' },
                    { value: 'keep', label: 'Keep my dose' },
                    { value: 'decrease', label: 'Decrease my dose' },
                    { value: 'not-continue', label: "I don't want to continue with this medication" }
                ];

                medicationConfigs.forEach(function (config, index) {
                    const slug = config.slug || `medication-${index + 1}`;
                    const label = config.label || 'the weight loss medication';
                    const storedValue = typeof config.continueDose === 'string' ? config.continueDose : '';
                    const normalizedStoredValue = normalizeValue(storedValue);

                    let fieldHtml = `
                        <div class="medication-continue-dose" data-medication="${escapeHtml(label)}">
                            <div class="old_title">
                                <h3 class="medication-subtitle">${escapeHtml(label)}</h3>
                            </div>
                            <div class="under">
                    `;

                    options.forEach(function (option, optionIndex) {
                        const optionValue = option.value;
                        const optionLabel = option.label;
                        const normalizedOptionValue = normalizeValue(optionValue);
                        const isChecked = normalizedStoredValue !== ''
                            ? normalizedStoredValue === normalizedOptionValue
                            : optionIndex === 0;
                        const requiredAttr = optionIndex === 0 ? ' required' : '';
                        const inputId = `continue-dose-${slug}-${toIdSuffix(optionValue, optionIndex)}`;

                        fieldHtml += `
                                <input type="radio" value="${escapeHtml(optionValue)}" id="${escapeHtml(inputId)}" name="continue-dose-${escapeHtml(slug)}"${requiredAttr}${isChecked ? ' checked' : ''}>
                                <label for="${escapeHtml(inputId)}">${escapeHtml(optionLabel)}</label>
                        `;
                    });

                    fieldHtml += `
                            </div>
                        </div>
                    `;

                    container.insertAdjacentHTML('beforeend', fieldHtml);

                    if (index === 0 && nextButton) {
                        nextButton.setAttribute('onclick', `submitForm('continue-dose-${slug}')`);
                    }
                });
            })();
        </script>
    </perch:if>
    <perch:if id="step" value="effects_with_wegovy">
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <div class="old_title">
                        <h2>Have you experienced any side effects with <span id="medication">the weight loss medication</span>? </h2>
                    </div>


                    <div class="unde">

                        <div class="button-group">
                            <button id="yesBtn" onclick="setValuesForm('effects_with_wegovy','yes')"  class="custom_btn"><span style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesForm('effects_with_wegovy','no')"  class="custom_btn"><span style="text-decoration: none; color: #000;" >No</span></button>
                            <input type="hidden" id="nextstep" name="nextstep" value="">
                            <input type="hidden" id="effects_with_wegovy" name="effects_with_wegovy" value="">


                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>
    </perch:if>
    <perch:if id="step" value="medication_allergies" >
        <section class="statements_apply">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="statement_content">
                            <div class="top_contents">
                              <!--  <div class="progress_bar">
                                    <p class="Percent_text">95%</p><span class="bar_line"></span>
                                </div>-->
                                <h5>
                                    Do you currently take any other medication or have any allergies? This includes prescribed medication, over-the-counter medication, and supplements. Select all that apply to you.
                                </h5>


                                <h5>
                                    It’s really important that we know about any medication you're taking so that we can make sure there are no interactions with your weight loss plan.
                                </h5>
                            </div>
                            <!--////////////========chekbox section start=======/////////////-->
                            <div class="box_group mt-2">
                                <div class="box_list" id="fullBox">
                                    <input type="checkbox" name="medication_allergies[]" value="levothyroxine" class="check1" onclick="changeColor()">
                                    <span class="box_text">I’m on levothyroxine</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox2">
                                    <input type="checkbox" name="medication_allergies[]" value="warfarin"  class="check1" onclick="changeColor2()">
                                    <span class="box_text">I’m on warfarin</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox3">
                                    <input type="checkbox" name="medication_allergies[]" value="other"   class="check1" onclick="changeColor3()">
                                    <span class="box_text">Other / I take more than one prescription medication</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox4">
                                    <input type="checkbox" name="medication_allergies[]"  value="no-medication"   class="check1" onclick="changeColor4()">
                                    <span class="box_text">I don’t take any medication</span>
                                </div>
                                <div class="box_list mt-2" id="fullBox5">
                                    <input type="checkbox" name="medication_allergies[]"  value="allergies" class="check1" onclick="changeColor5()">
                                    <span class="box_text">I have allergies</span>
                                </div>





                            </div>
                            <!--////////////========chekbox section END=======/////////////-->

                            <div class="mt-4" id="otherMedicationDetailsWrapper" style="display:none;">
                                <label for="other_medication_details">Please provide details of the other medication you take, including the name, dose, and how often you take this.</label>
                                <textarea id="other_medication_details" name="other_medication_details" placeholder="Medication name – dose – how often"></textarea>
                                <p id="otherMedicationDetailsError" class="error-message">Please provide an answer before continuing.</p>
                            </div>

                            <!--////////////========Button section Start=======/////////////-->
                            <div class="bottom_btn mt-5">
                                <input type="hidden" id="nextstep" name="nextstep" value="gp_informed">


                                <button class="btn_back"><a href='<perch:forms id="previousPage"  />'>Back</a></button>
                               <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                                <button id="nextButton" class="btn_next" onclick="submitForm('medication_allergies')" disabled><span>Next <i class="fa-solid fa-arrow-right"></i></span></button>
                            </div>
                            <!--////////////========Button section END=======/////////////-->

                        </div>
                    </div>
                </div>
            </div>
        </section>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var checkboxes = document.querySelectorAll('input[name="medication_allergies[]"]');
                var nextButton = document.getElementById('nextButton');
                var nextStepField = document.getElementById('nextstep');
                var detailsWrapper = document.getElementById('otherMedicationDetailsWrapper');
                var detailsField = document.getElementById('other_medication_details');
                var detailsError = document.getElementById('otherMedicationDetailsError');

                if (!checkboxes.length || !nextStepField) {
                    return;
                }

                var toArray = function (nodeList) {
                    return Array.prototype.slice.call(nodeList);
                };

                var updateState = function () {
                    var selectedValues = toArray(checkboxes)
                        .filter(function (checkbox) {
                            return checkbox.checked;
                        })
                        .map(function (checkbox) {
                            return checkbox.value;
                        });

                    var hasSelection = selectedValues.length > 0;
                    var requiresDetails = selectedValues.indexOf('other') !== -1;
                    var detailsFilled = true;

                    if (detailsWrapper) {
                        detailsWrapper.style.display = requiresDetails ? '' : 'none';
                    }

                    if (detailsField) {
                        detailsField.required = requiresDetails;
                        if (requiresDetails) {
                            detailsFilled = detailsField.value.trim() !== '';
                        }
                    }

                    if (detailsError) {
                        detailsError.style.display = requiresDetails && !detailsFilled ? '' : 'none';
                    }

                    if (nextButton) {
                        nextButton.disabled = !(hasSelection && detailsFilled);
                    }

                    if (nextStepField) {
                        nextStepField.value = 'gp_informed';
                    }
                };

                toArray(checkboxes).forEach(function (checkbox) {
                    checkbox.addEventListener('change', updateState);
                });

                if (detailsField) {
                    detailsField.addEventListener('input', updateState);
                }

                updateState();
            });
        </script>
    </perch:if>
    <perch:if id="step" value="list_any_medications" >
        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                       <div class="nambar">
                           <span>22%</span>
                       </div>

                   </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="other_medical_conditions">Please list any other medical conditions you have. <br> <br> Our clinicians need to know your full medical history to make sure our weight loss plan is safe for you.</label>
                    <textarea id="other_medical_conditions" required name="other_medical_conditions" placeholder="My health conditions are..."></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <input type="hidden" id="nextstep" name="nextstep" value="medications">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href='<perch:forms id="previousPage"  />'>Back</a></button>
                       <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                        <button type="submit" onclick="submitForm('other_medical_conditions')"  class="next" id="" ><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>
                </form>
            </div>
        </section>


    </perch:if>
    <perch:if id="step" value="list_any" >
        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                       <div class="nambar">
                           <span>22%</span>
                       </div>

                   </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="other_medical_conditions">Please list any other medical conditions you have. <br> <br> Our clinicians need to know your full medical history to make sure our weight loss plan is safe for you.</label>
                    <textarea id="other_medical_conditions" required name="other_medical_conditions" placeholder="My health conditions are..."></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <input type="hidden" id="nextstep" name="nextstep" value="medications">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href='<perch:forms id="previousPage"  />'>Back</a></button>
                       <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                        <button type="submit" onclick="submitForm('other_medical_conditions')"  class="next" id="" ><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>
                </form>
            </div>
        </section>


    </perch:if>
    <perch:if id="step" value="wegovy_side_effects" >

        <section class="how_old ">
            <div class="mixed">
                <div class="bar">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                </div>
                <form id="ethnicityForm">
                    <label for="wegovy_side_effects">Please tell us as much as you can about your side effects - the type, duration, severity and whether they have resolved.</label>
                    <textarea id="wegovy_side_effects" required name="wegovy_side_effects" placeholder=""></textarea>
                    <p id="error-message" class="error-message">Please provide an answer before continuing.</p>
                    <div class="buttons">
                        <button type="button" class="back"><a style="text-decoration: none;
                                    color: #000;" href='<perch:forms id="previousPage"  />'>Back</a></button>
                        <input type="hidden" id="nextstep" name="nextstep" value="medication_allergies">
                       <!-- <perch:if id="reviewed" value="InProcess" ><button id="reviewButton" style="background-color: rgb(176, 209, 54);" class="btn_next" ><a href='/get-started/review-questionnaire'>Back to Review Page</a></button></perch:if>-->

                        <button type="submit"  onclick="submitForm('wegovy_side_effects')"  class="next"><span style="text-decoration: none; color: #000;" >Next →</span></button>

                    </div>
                </form>
            </div>
        </section>



    </perch:if>
    <perch:if id="step" value="gp_informed" >
        <section class="how_old">
            <div class="contanier">
                <div class="are_you">
                    <!--  <div class="progress_bar">
                       <div class="nambar">
                           <span>22%</span>
                       </div>

                   </div>-->
                    <div class="old_title">
                        <h2>Would you like your GP to be informed of this consultation?</h2><br>

                        <p style="font-weight: 600;" >To ensure we provide the best and safest service for you, we strongly encourage you to share your GP details so we can inform them about your treatment. If you are aware of your GP practice's email address, please enter them on the next screen.</p>
                    </div>


                    <div class="unde">

                        <div class="button-group">
                            <button id="yesBtn" onclick="setValuesForm('gp_informed','yes')"  class="custom_btn"><span style="text-decoration: none; color: #000;" >Yes</span></button>
                            <button id="noBtn" onclick="setValuesForm('gp_informed','no')" class="custom_btn"><span style="text-decoration: none; color: #000;" >No</span></button>
                            <input type="hidden" id="nextstep" name="nextstep" value="">
                            <input type="hidden" id="gp_informed" name="gp_informed" value="">

                        </div>

                    </div>
                    <div class="get_started">
                        <div class="started_button">
                            <div class="get_btn">
                                <button><a href='<perch:forms id="previousPage"  />'>Back</a></button>

                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>


    </perch:if>

    <perch:if id="step" value="gp_address">

        <section class="how_old">
            <div class="contanier">
                <div class="what_Is_your">
                    <!--  <div class="progress_bar">
                       <div class="nambar">
                           <span>22%</span>
                       </div>

                   </div>-->
                    <h2>Please enter your GP's email address</h2>
                    <div class="weight-inputs">
                        <input type="text" id="GP_email_address"  name="GP_email_address" placeholder="GP’s e-mail address" style="width: 100%;" >

                        <input type="hidden" id="nextstep" name="nextstep" value="access_special_offers">

                    </div>


                    <div class="buttons skip ">
                        <button class="back skip_button "><a href="/get-started/questionnaire?step=access_special_offers" style="text-decoration: none;color: #000;" >Skip</a></button>
                    </div>


                    <div class="buttons">
                        <button class="back"><a href='<perch:forms id="previousPage"  />' style="text-decoration: none;color: #000;" >Back</a></button>

                        <button onclick="submitForm('GP_email_address')" class="next"><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>
                </div>

            </div>

        </section>

    </perch:if>
    <perch:if id="step" value="access_special_offers">


        <section class="how_old">
            <div class="contanier">
                <div class="what_Is_your">
                    <!--  <div class="progress_bar">
                      <div class="nambar">
                          <span>22%</span>
                      </div>

                  </div>-->
                    <h2>Get access to special offers</h2>
                    <p style="font-weight: 600;" >Take the first step towards improving your metabolic health. You'll receive personalised health insights and exclusive monthly offers available only to Get Weight Loss members.</p>
                    <div class="weight-inputs">
                        <input type="text" id="email_address" name="email_address" placeholder="Email address (optional)" style="width: 100%;" >



                    </div>


                    <div class="buttons skip ">
                        <button class="back skip_button "><a href="/get-started/review-questionnaire" style="text-decoration: none;color: #000;" >Skip</a></button>
                    </div>


                    <div class="buttons">


                          <input type="hidden" id="nextstep" name="nextstep" value="plans">
                        <button class="back"><a href='<perch:forms id="previousPage"  />' style="text-decoration: none;color: #000;" >Back</a></button>

                        <button onclick="submitForm('access_special_offers')"  class="next"><span style="text-decoration: none;color: #000;" >Next →</span></button>
                    </div>
                </div>

            </div>

        </section>

    </perch:if>




</perch:form>
<style>
    .custom_btn.active {
        background: #00000052;
        color: #fff !important;
    }

</style>
