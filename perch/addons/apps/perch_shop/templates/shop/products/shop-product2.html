
<div class="mx-auto mb-[24px] w-full max-w-[960px] text-[13px] font-semibold text-slate-500">
    <a href="/shop" class="text-[#3328bf] hover:text-[#2a21a3]">‚Üê Back to shop</a>
    <perch:if exists="category_slug">
        <span class="mx-[8px] text-slate-300">|</span>
        <a href="/shop/products?category=<perch:show id="category_slug" />" class="text-[#3328bf] hover:text-[#2a21a3]">
        Back to category
        </a>
    </perch:if>
</div>

<div class="mx-auto w-full max-w-[960px] rounded-[24px] border border-slate-200 bg-white p-[24px] md:p-[40px] shadow-sm">
    <div class="grid gap-[32px] md:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]">
        <div class="rounded-[20px] bg-slate-100 p-[16px]">
            <div class="product-gallery grid gap-[16px]">
                <div class="overflow-hidden rounded-[16px] bg-white">
                    <div class="flex snap-x snap-mandatory overflow-x-auto scroll-smooth">
                        <div id="product-image-main" class="min-w-full snap-center">
                            <perch:shop id="image" />
                            <img src="<perch:shop id="image" type="image" label="Main product image" />" alt="<perch:shop id="title" type="text" />" class="h-auto w-full object-cover">
                        </div>
                        <perch:repeater id="_variant_images">
                            <div id="product-image-<perch:counter />" class="min-w-full snap-center">
                                <img src="<perch:shop id="variant_image" type="image" />" alt="<perch:shop id="title" type="text" />" class="h-auto w-full object-cover">
                            </div>
                        </perch:repeater>
                    </div>
                </div>
                <div class="flex gap-[12px] overflow-x-auto pb-[4px]">
                    <a href="#product-image-main" class="block w-[80px] shrink-0 overflow-hidden rounded-[12px] bg-white">
                        <img src="<perch:shop id="image" type="image" label="Main product image" />" alt="<perch:shop id="title" type="text" />" class="h-full w-full object-cover">
                    </a>
                    <perch:repeater id="_variant_images">
                        <a href="#product-image-<perch:counter />" class="block w-[80px] shrink-0 overflow-hidden rounded-[12px] bg-white">
                            <img src="<perch:shop id="variant_image" type="image" />" alt="<perch:shop id="title" type="text" />" class="h-full w-full object-cover">
                        </a>
                    </perch:repeater>
                </div>
            </div>
        </div>

        <div class="flex flex-col">
            <p class="text-[12px] font-semibold uppercase tracking-[0.2em] text-[#3328bf]">Shop product</p>
            <h1 class="mt-[12px] text-[28px] md:text-[34px] font-semibold text-[#0f172a]"><perch:shop id="title" type="text" /></h1>
            <p class="mt-[16px] text-[15px] text-slate-600"><perch:shop id="shortdescription" type="textarea" /></p>

            <div class="mt-[20px] text-[22px] font-semibold text-[#0f172a]">
                <perch:if exists="sale_price">
                    <span><perch:shop id="sale_price" type="shop_currency_value" /></span>
                    <span class="ml-[10px] text-[14px] font-normal text-slate-400 line-through">
            <perch:shop id="price" type="shop_currency_value" />
          </span>
                    <perch:else />
                    <perch:shop id="price" type="shop_currency_value" />
                </perch:if>
            </div>

            <div class="mt-[24px]">
                <perch:if not-exists="has_variants">
                    <perch:form id="add_to_cart" app="perch_shop" action="/order/cart">
                        <perch:input id="product" type="hidden" value="<perch:shop id="productID" env-autofill="false" />" />
                        <perch:input type="submit" value="Add to cart" class="w-full rounded-full bg-[#3328bf] px-[18px] py-[12px] text-[14px] font-semibold text-white hover:bg-[#2a21a3] transition" />
                    </perch:form>
                    <perch:else />
                    <div class="flex flex-col gap-[16px] rounded-[16px] border border-slate-200 bg-slate-50 p-[16px]">
                        <div>
                            <span class="text-[12px] font-semibold uppercase tracking-[0.12em] text-slate-500">Color</span>
                            <div class="variant-options mt-[10px] flex flex-wrap gap-[8px]"></div>
                            <perch:form id="cart" action="" app="perch_shop">
                                <perch:input class="variant-select mt-[8px] w-full rounded-[10px] border border-slate-200 bg-white px-[12px] py-[10px] text-[14px]"
                                             type="select"  id="product"  name="product"
                                             options="<perch:shop id="_variant_opts" type="hidden" />" />
                                <div style="padding: 10px;">
                                    <perch:input type="submit" value="Add to cart"
                                                 class="w-full rounded-full bg-[#3328bf] px-[18px] py-[12px] text-[14px] font-semibold text-white hover:bg-[#2a21a3] transition" />
                                </div>
                            </perch:form>

                        </div>

                    </div>
                </perch:if>
            </div>
        </div>
    </div>
    <div class="mt-[32px] border-t border-slate-200 pt-[24px] text-[15px] text-slate-600">
        <perch:shop id="description" type="textarea" />
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const select = document.querySelector('.variant-select');
        const container = document.querySelector('.variant-options');
        if (!select || !container) return;

        const options = Array.from(select.options).filter((option) => option.value);
        container.innerHTML = '';

        options.forEach((option, index) => {
            const button = document.createElement('button');
            button.type = 'button';
            button.textContent = option.textContent;
            button.dataset.value = option.value;
            button.dataset.index = String(index + 1);
            button.className = 'rounded-full border border-slate-200 px-[14px] py-[8px] text-[13px] font-semibold text-slate-600 transition hover:border-[#3328bf] hover:text-[#3328bf]';
            container.appendChild(button);
        });

        const updateActive = (value) => {
            container.querySelectorAll('button').forEach((button) => {
                const isActive = button.dataset.value === value;
                button.classList.toggle('border-[#3328bf]', isActive);
                button.classList.toggle('bg-[#3328bf]', isActive);
                button.classList.toggle('text-white', isActive);
                button.classList.toggle('text-slate-600', !isActive);
            });
        };

        const scrollToImage = (index) => {
            const target = document.getElementById(`product-image-${index}`);
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        };

        container.addEventListener('click', (event) => {
            const button = event.target.closest('button');
            if (!button) return;
            select.value = button.dataset.value;
            updateActive(select.value);
            scrollToImage(button.dataset.index);
        });

        select.addEventListener('change', (event) => {
            updateActive(event.target.value);
        });

        updateActive(select.value || options[0]?.value || '');
    });
</script>
