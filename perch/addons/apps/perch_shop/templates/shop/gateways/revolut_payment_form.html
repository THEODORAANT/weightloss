<head><title>Shop</title><script>!function(e,o,t){var n={sandbox:"https://sandbox-merchant.revolut.com/embed.js",prod:"https://merchant.revolut.com/embed.js",dev:"https://merchant.revolut.codes/embed.js"},r={sandbox:"https://sandbox-merchant.revolut.com/upsell/embed.js",prod:"https://merchant.revolut.com/upsell/embed.js",dev:"https://merchant.revolut.codes/upsell/embed.js"},l=function(e){var n=function(e){var t=o.createElement("script");return t.id="revolut-checkout",t.src=e,t.async=!0,o.head.appendChild(t),t}(e);return new Promise((function(e,r){n.onload=function(){return e()},n.onerror=function(){o.head.removeChild(n),r(new Error(t+" failed to load"))}}))},u=function(){if(window.RevolutCheckout===i||!window.RevolutCheckout)throw new Error(t+" failed to load")},c={},d={},i=function o(r,d){return c[d=d||"prod"]?Promise.resolve(c[d](r)):l(n[d]).then((function(){return u(),c[d]=window.RevolutCheckout,e[t]=o,c[d](r)}))};i.payments=function(o){var r=o.mode||"prod",d={locale:o.locale||"auto",publicToken:o.publicToken||null};return c[r]?Promise.resolve(c[r].payments(d)):l(n[r]).then((function(){return u(),c[r]=window.RevolutCheckout,e[t]=i,c[r].payments(d)}))},i.upsell=function(e){var o=e.mode||"prod",n={locale:e.locale||"auto",publicToken:e.publicToken||null};return d[o]?Promise.resolve(d[o](n)):l(r[o]).then((function(){if(!window.RevolutUpsell)throw new Error(t+" failed to load");return d[o]=window.RevolutUpsell,delete window.RevolutUpsell,d[o](n)}))},e[t]=i}(window,document,"RevolutCheckout");
</script></head>

<button id="pay-button">Pay</button>


<script>
    var pspmode='<perch:shop id="pspmode" escape="true" />';

    var token='<perch:shop id="token" escape="true" />';//'<?php echo $_GET["token"]; ?>';
    RevolutCheckout(token, pspmode).then(function (RC) {
        var payButton = document.getElementById("pay-button");
        // On click open payment pop-up
        payButton.addEventListener("click", function () {
            RC.payWithPopup({
                // (mandatory!) name of the cardholder
                name: '<perch:shop id="customer_name" escape="true" />',
                // (optional) email of the customer
               // email: "customer@example.com",
                // (optional) phone of the customer
               // phone: "+447950630319",
                savePaymentMethodFor: "merchant",
                // (optional) billing address of the customer
               /* billingAddress: {
                    countryCode: "GB", //if sending billing address, this field is mandatory
                    region: "Greater London",
                    city: "London",
                    streetLine1: "Revolut",
                    streetLine2: "1 Canada Square",
                    postcode: "EC2V 6DN", //if sending billing address, this field is mandatory
                },*/

                // Callback called when payment finished successfully
                onSuccess(data) {

                    location.href = '<perch:shop id="success_url" escape="true" />?id=<perch:shop id="revolutid" escape="true" />';
                  //  window.alert("Thank you!");
                },
                // Callback in case some error happened
                onError(message) {
                    location.href = '<perch:shop id="cancel_url" escape="true" />';
                    console.log("messeage");
                    console.log(message);
                   // window.alert("Oh no :(");
                },
                // (optional) Callback in case user cancelled a transaction
                onCancel() {
                    location.href = '<perch:shop id="cancel_url" escape="true" />';
                   // window.alert("Payment cancelled!");
                },
            });
        });
    });
</script>
