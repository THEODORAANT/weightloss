<?php
eval(base64_decode('I1tcQWxsb3dEeW5hbWljUHJvcGVydGllc10KY2xhc3MgUGVyY2hBdXRoZW50aWNhdGVkVXNlciBleHRlbmRzIFBlcmNoQmFzZQp7CiAgICBwcm90ZWN0ZWQgJHRhYmxlICA9ICd1c2Vycyc7CiAgICBwcm90ZWN0ZWQgJHBrICAgICA9ICd1c2VySUQnOwoKICAgIHB1YmxpYyAkYWN0aXZhdGlvbl9mYWlsZWQgPSBmYWxzZTsKCiAgICBwcml2YXRlICRsb2dnZWRfaW4gPSBmYWxzZTsKCiAgICBwcml2YXRlICRwcml2aWxlZ2VzID0gW107CiAgICBwcml2YXRlICRidWNrZXRzICAgID0gbnVsbDsKCiAgICBwdWJsaWMgZnVuY3Rpb24gYXV0aGVudGljYXRlKCR1c2VybmFtZSwgJHBhc3N3b3JkKQogICAgewoKCiAgICAgICAgLy8gUGFzc3dvcmRzIHNob3VsZCBuZXZlciBiZSBsb25nZXIgdGhhbiA3MiBjaGFyYWN0ZXJzCiAgICAgICAgaWYgKHN0cmxlbigkcGFzc3dvcmQpID4gNzIpIHJldHVybiBmYWxzZTsKCiAgICAgICAgJHVzZXJuYW1lID0gZmlsdGVyX3ZhcigkdXNlcm5hbWUsIEZJTFRFUl9TQU5JVElaRV9GVUxMX1NQRUNJQUxfQ0hBUlMsIEZJTFRFUl9GTEFHX1NUUklQX0xPVyk7CgogICAgICAgIGlmIChQRVJDSF9QQVJBTk9JRCkgewogICAgICAgICAgICAvLyByZXNldCBhbnkgZXhwaXJlZCBsb2Nrb3V0cyBmb3IgdGhpcyB1c2VyCiAgICAgICAgICAgICRzcWwgPSAnVVBEQVRFICcuJHRoaXMtPnRhYmxlLicgU0VUIHVzZXJMYXN0RmFpbGVkTG9naW49TlVMTCwgdXNlckZhaWxlZExvZ2luQXR0ZW1wdHM9MAogICAgICAgICAgICAgICAgICAgIFdIRVJFIEJJTkFSWSB1c2VyVXNlcm5hbWU9Jy4gJHRoaXMtPmRiLT5wZGIoJHVzZXJuYW1lKS4nIAogICAgICAgICAgICAgICAgICAgICAgICBBTkQgdXNlckxhc3RGYWlsZWRMb2dpbjwnLiR0aGlzLT5kYi0+cGRiKGRhdGUoJ1ktbS1kIEg6aTpzJywgc3RydG90aW1lKCctJy5QRVJDSF9BVVRIX0xPQ0tPVVRfRFVSQVRJT04pKSk7CiAgICAgICAgICAgICR0aGlzLT5kYi0+ZXhlY3V0ZSgkc3FsKTsKICAgICAgICB9CgogICAgICAgICRzcWwgICAgID0gJ1NFTEVDVCB1LiosIHIuKiBGUk9NICcgLiAkdGhpcy0+dGFibGUgLiAnIHUsICcuUEVSQ0hfREJfUFJFRklYLid1c2VyX3JvbGVzIHIKICAgICAgICAgICAgICAgICAgICBXSEVSRSB1LnJvbGVJRD1yLnJvbGVJRCBBTkQgdS51c2VyRW5hYmxlZD0xIEFORCAnOwoKICAgICAgICBpZiAoUEVSQ0hfUEFSQU5PSUQpIHsKICAgICAgICAgICAgJHNxbCAuPSAgJ0JJTkFSWSB1c2VyVXNlcm5hbWU9JyAuICR0aGlzLT5kYi0+cGRiKCR1c2VybmFtZSkgLicgQU5EIHVzZXJGYWlsZWRMb2dpbkF0dGVtcHRzPCcuKGludClQRVJDSF9NQVhfRkFJTEVEX0xPR0lOUzsKICAgICAgICB9ZWxzZXsKCiAgICAgICAgICAgICRzcWwgLj0gICd1c2VyVXNlcm5hbWU9JyAuICR0aGlzLT5kYi0+cGRiKCR1c2VybmFtZSk7CgoKICAgICAgICB9CgogICAgICAgICRzcWwgLj0gICcgTElNSVQgMSc7CgogICAgICAgICRyZXN1bHQgPSAkdGhpcy0+ZGItPmdldF9yb3coJHNxbCk7CiAgICAgICAgaWYgKGlzX2FycmF5KCRyZXN1bHQpKSB7CiAgICAgICAgICAgIFBlcmNoVXRpbDo6ZGVidWcoJ1VzZXIgZXhpc3RzLCBjaGVja2luZyBwYXNzd29yZC4nKTsKCiAgICAgICAgICAgIC8vIHByZXN1bWUgcGFzc3dvcmQgZmFpbC4KICAgICAgICAgICAgJHBhc3N3b3JkX21hdGNoICA9IGZhbHNlOwogICAgICAgICAgICAkc3RvcmVkX3Bhc3N3b3JkID0gJHJlc3VsdFsndXNlclBhc3N3b3JkJ107CgogICAgICAgICAgICAkSGFzaGVyID0gUGVyY2hVdGlsOjpnZXRfcGFzc3dvcmRfaGFzaGVyKCk7CgoKICAgICAgICAgICAgLy8gZGF0YSBhcnJheSBmb3IgdXNlciBkZXRhaWxzIC0gZ2V0cyBjb21taXR0ZWQgaWYgcGFzc3dvcmRzIGNoZWNrIG91dC4KICAgICAgICAgICAgJGRhdGEgPSBhcnJheSgpOwoKICAgICAgICAgICAgLy8gY2hlY2sgcGFzc3dvcmQgdHlwZQogICAgICAgICAgICBpZiAoc3Vic3RyKCRzdG9yZWRfcGFzc3dvcmQsIDAsIDMpPT0nJFAkJykgewogICAgICAgICAgICAgICAgUGVyY2hVdGlsOjpkZWJ1ZygnU3Ryb25nZXIgcGFzc3dvcmQgaGFzaC4nKTsKCiAgICAgICAgICAgICAgICAvLyBzdHJvbmdlciBoYXNoLCBjaGVjayBwYXNzd29yZAogICAgICAgICAgICAgICAgaWYgKCRIYXNoZXItPkNoZWNrUGFzc3dvcmQoJHBhc3N3b3JkLCAkc3RvcmVkX3Bhc3N3b3JkKSkgewogICAgICAgICAgICAgICAgICAgICRwYXNzd29yZF9tYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgUGVyY2hVdGlsOjpkZWJ1ZygnUGFzc3dvcmQgaXMgb2suJyk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBQZXJjaFV0aWw6OmRlYnVnKCdQYXNzd29yZCBmYWlsZWQgdG8gbWF0Y2guJyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIC8vIG9sZCBNRDUgcGFzc3dvcmQKICAgICAgICAgICAgICAgIFBlcmNoVXRpbDo6ZGVidWcoJ09sZCBNRDUgcGFzc3dvcmQuJyk7CiAgICAgICAgICAgICAgICBpZiAoJHN0b3JlZF9wYXNzd29yZCA9PSBtZDUoJHBhc3N3b3JkKSkgewogICAgICAgICAgICAgICAgICAgICRwYXNzd29yZF9tYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgUGVyY2hVdGlsOjpkZWJ1ZygnUGFzc3dvcmQgaXMgb2suIFVwZ3JhZGluZy4nKTsKICAgICAgICAgICAgICAgICAgICAvL3VwZ3JhZGUhCiAgICAgICAgICAgICAgICAgICAgJGhhc2hlZF9wYXNzd29yZCA9ICRIYXNoZXItPkhhc2hQYXNzd29yZCgkcGFzc3dvcmQpOwogICAgICAgICAgICAgICAgICAgICRkYXRhWyd1c2VyUGFzc3dvcmQnXSA9ICRoYXNoZWRfcGFzc3dvcmQ7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICBQZXJjaFV0aWw6OmRlYnVnKCdNRDUgcGFzc3dvcmQgZmFpbGVkIHRvIG1hdGNoLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJHBhc3N3b3JkX21hdGNoKSB7CgogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5hY3RpdmF0ZSgpKSB7CgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5zZXRfZGV0YWlscygkcmVzdWx0KTsKCiAgICAgICAgICAgICAgICAgICAgJGRhdGFbJ3VzZXJIYXNoJ10gICAgICAgICAgICAgICAgPSBtZDUodW5pcWlkKCkpOwogICAgICAgICAgICAgICAgICAgICRkYXRhWyd1c2VyTGFzdExvZ2luJ10gICAgICAgICAgID0gZGF0ZSgnWS1tLWQgSDppOnMnKTsKICAgICAgICAgICAgICAgICAgICAkZGF0YVsndXNlckZhaWxlZExvZ2luQXR0ZW1wdHMnXSA9IDA7CiAgICAgICAgICAgICAgICAgICAgJGRhdGFbJ3VzZXJMYXN0RmFpbGVkTG9naW4nXSAgICAgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT51cGRhdGUoJGRhdGEpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5yZXN1bHRbJ3VzZXJIYXNoJ10gICAgICAgID0gJGRhdGFbJ3VzZXJIYXNoJ107CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPnNldF9kZXRhaWxzKCRyZXN1bHQpOwoKICAgICAgICAgICAgICAgICAgICBQZXJjaFNlc3Npb246OnJlZ2VuZXJhdGUoKTsKICAgICAgICAgICAgICAgICAgICBQZXJjaFNlc3Npb246OnNldCgndXNlcklEJywgJHJlc3VsdFsndXNlcklEJ10pOwogICAgICAgICAgICAgICAgICAgIFBlcmNoU2Vzc2lvbjo6c2V0KCd1c2VySGFzaCcsICRkYXRhWyd1c2VySGFzaCddKTsKCgogICAgICAgICAgICAgICAgICAgICR0aGlzLT5sb2dnZWRfaW4gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICR0aGlzLT5fbG9hZF9wcml2aWxlZ2VzKCk7CgogICAgICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPmhhc19wcml2KCdwZXJjaC5sb2dpbicpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBlcmNoVXRpbDo6ZGVidWcoJ1VzZXIgcm9sZSBkb2VzIG5vdCBoYXZlIGxvZ2luIHByaXZzJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5sb2dvdXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGNvb2tpZSBmb3IgZnJvbnQtZW5kIG1pZ2h0LWJlLWF1dGhlZCBjaGVjawogICAgICAgICAgICAgICAgICAgIFBlcmNoVXRpbDo6c2V0Y29va2llKCdjbXNhJywgMSwgc3RydG90aW1lKCcrMzAgZGF5cycpLCAnLycpOwoKICAgICAgICAgICAgICAgICAgICAkUGVyY2ggPSBQZXJjaDo6ZmV0Y2goKTsKICAgICAgICAgICAgICAgICAgICAkUGVyY2gtPmV2ZW50KCd1c2VyLmxvZ2luJywgJHRoaXMpOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gVXNlcm5hbWUgY2hlY2tzIG91dCwgYnV0IHdyb25nIHBhc3N3b3JkLgogICAgICAgICAgICAkZGF0YVsndXNlckZhaWxlZExvZ2luQXR0ZW1wdHMnXSA9IChpbnQpJHJlc3VsdFsndXNlckZhaWxlZExvZ2luQXR0ZW1wdHMnXSArIDE7CiAgICAgICAgICAgICRkYXRhWyd1c2VyTGFzdEZhaWxlZExvZ2luJ10gICAgID0gZGF0ZSgnWS1tLWQgSDppOnMnKTsgIAogICAgICAgICAgICAkdGhpcy0+c2V0X2RldGFpbHMoJHJlc3VsdCk7CiAgICAgICAgICAgICR0aGlzLT51cGRhdGUoJGRhdGEpOwoKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChQRVJDSF9QQVJBTk9JRCAmJiAkZGF0YVsndXNlckZhaWxlZExvZ2luQXR0ZW1wdHMnXSA9PSBQRVJDSF9NQVhfRkFJTEVEX0xPR0lOUykgewogICAgICAgICAgICAgICAgJHRoaXMtPnNlbmRfbG9ja291dF9lbWFpbCgkcmVzdWx0Wyd1c2VySUQnXSk7CiAgICAgICAgICAgIH0gICAgCiAgICAgICAgCiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAKCiAgICAgICAgUGVyY2hVdGlsOjpkZWJ1ZygnV3JpdGluZyBhdXRoIGZhaWwgdG8gbG9nLicpOwogICAgICAgICR1c2VybmFtZSA9IGVzY2FwZXNoZWxsY21kKHN0cmlwc2xhc2hlcygkdXNlcm5hbWUpKTsKICAgICAgICBAc3lzbG9nKExPR19JTkZPLCAnQXV0aGVudGljYXRpb24gZmFpbHVyZSBmb3IgJy4kdXNlcm5hbWUuJyBmcm9tICcuUGVyY2hVdGlsOjpnZXRfY2xpZW50X2lwKCkpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHJlY292ZXIoKQogICAgewogICAgICAgIGlmIChQZXJjaFNlc3Npb246OmlzX3NldCgndXNlcklEJykpIHsKICAgICAgICAgICAgJHNxbCAgICAgPSAnU0VMRUNUIHUuKiwgci4qIEZST00gJyAuICR0aGlzLT50YWJsZSAuICcgdSwgJy5QRVJDSF9EQl9QUkVGSVguJ3VzZXJfcm9sZXMgcgogICAgICAgICAgICAgICAgICAgICAgICBXSEVSRSB1LnJvbGVJRD1yLnJvbGVJRCBBTkQgdS51c2VyRW5hYmxlZD0xIEFORCB1LnVzZXJJRD0nIC4gJHRoaXMtPmRiLT5wZGIoKGludClQZXJjaFNlc3Npb246OmdldCgndXNlcklEJykpIC4gJwogICAgICAgICAgICAgICAgICAgICAgICAgQU5EIHUudXNlckhhc2g9JyAuICR0aGlzLT5kYi0+cGRiKFBlcmNoU2Vzc2lvbjo6Z2V0KCd1c2VySGFzaCcpKSAuICcKICAgICAgICAgICAgICAgICAgICAgICAgTElNSVQgMSc7CgogICAgICAgICAgICAkcmVzdWx0ID0gJHRoaXMtPmRiLT5nZXRfcm93KCRzcWwpOwoKICAgICAgICAgICAgaWYgKGlzX2FycmF5KCRyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAkdGhpcy0+c2V0X2RldGFpbHMoJHJlc3VsdCk7CiAgICAgICAgICAgICAgICAkZGF0YSA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICAkZGF0YVsndXNlckhhc2gnXSA9IG1kNSh1bmlxaWQoKSk7CiAgICAgICAgICAgICAgICAkdGhpcy0+dXBkYXRlKCRkYXRhKTsKICAgICAgICAgICAgICAgICR0aGlzLT5yZXN1bHRbJ3VzZXJIYXNoJ10gPSAkZGF0YVsndXNlckhhc2gnXTsKICAgICAgICAgICAgICAgICR0aGlzLT5zZXRfZGV0YWlscygkcmVzdWx0KTsKCiAgICAgICAgICAgICAgICBQZXJjaFNlc3Npb246OnNldCgndXNlckhhc2gnLCAkZGF0YVsndXNlckhhc2gnXSk7CgogICAgICAgICAgICAgICAgJHRoaXMtPmxvZ2dlZF9pbiA9IHRydWU7CiAgICAgICAgICAgICAgICAkdGhpcy0+X2xvYWRfcHJpdmlsZWdlcygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHRoaXMtPmxvZ2dlZF9pbiA9IGZhbHNlOwogICAgICAgICR0aGlzLT5wcml2aWxlZ2VzID0gYXJyYXkoKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGxvZ291dCgpCiAgICB7CiAgICAgICAgJHRoaXMtPmxvZ2dlZF9pbiA9IGZhbHNlOwogICAgICAgIFBlcmNoU2Vzc2lvbjo6ZGVsZXRlKCd1c2VySUQnKTsKICAgICAgICBQZXJjaFNlc3Npb246OmRlbGV0ZSgndXNlckhhc2gnKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gbG9nZ2VkX2luKCkKICAgIHsKICAgICAgICByZXR1cm4gJHRoaXMtPmxvZ2dlZF9pbjsKICAgIH0KCiAgICBwcml2YXRlIGZ1bmN0aW9uIGFjdGl2YXRlKCkKICAgIHsKICAgICAgICAvKgogICAgICAgICAgICBBbnkgYXR0ZW1wdCB0byBjaXJjdW12ZW50IGFjdGl2YXRpb24gaW52YWxpZGF0ZXMgeW91ciBsaWNlbnNlIHRvIHVzZSB0aGlzIHNvZnR3YXJlLgogICAgICAgICAgICBXZSdyZSBhIHNtYWxsIGNvbXBhbnkgdHJ5aW5nIHRvIG1ha2Ugc29tZXRoaW5nIHVzZWZ1bCBhdCBhIGZhaXIgcHJpY2UgLSBpZiB5b3UgZG9uJ3QgcGF5CiAgICAgICAgICAgIHRoZW4gd2UgY2FuJ3QgY29udGludWUgYW5kIGl0IHdpbGwganVzdCBnbyBhd2F5LiBJZiB5b3Ugd2FudCBzb21ldGhpbmcgZnJlZSwgdGhlcmUgYXJlIGxvdHMKICAgICAgICAgICAgb2YgZnJlZSBhbHRlcm5hdGl2ZXMgYXZhaWxhYmxlIC0geW91IGNhbiB1c2UgdGhvc2UgYW5kIHJlbWFpbiBob25lc3QuCiAgICAgICAgKi8KcmV0dXJuIHRydWU7CiAgICAgICAgJFBlcmNoICA9IFBlcmNoQWRtaW46OmZldGNoKCk7CgogICAgICAgICRob3N0ID0gJ2FjdGl2YXRpb24uZ3JhYmFwZXJjaC5jb20nOwogICAgICAgICRwYXRoID0gJy9hY3RpdmF0ZS92My8nOwogICAgICAgICR1cmwgPSAnaHR0cDovLycgLiAkaG9zdCAuICRwYXRoOwogICAgICAgICRkYXRhID0gW107CiAgICAgICAgJGRhdGFbJ2tleSddICAgICA9IFBFUkNIX0xJQ0VOU0VfS0VZOwogICAgICAgLy8gJGRhdGFbJ2hvc3QnXSAgICA9ICJwZXJjaC1kZXZlbG9wbWVudC5henVyZXdlYnNpdGVzLm5ldCI7CiAgICAgICAgJGRhdGFbJ2hvc3QnXSAgICA9ICRfU0VSVkVSWydTRVJWRVJfTkFNRSddOwogICAgICAgICRkYXRhWyd2ZXJzaW9uJ10gPSAkUGVyY2gtPnZlcnNpb247CiAgICAgICAgJGRhdGFbJ3BocCddICAgICA9IHBocHZlcnNpb24oKTsKICAgICAgICAkY29udGVudCA9IGh0dHBfYnVpbGRfcXVlcnkoJGRhdGEpOwoKICAgICAgICAkcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgJHVzZV9jdXJsID0gZmFsc2U7CiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnY3VybF9pbml0JykpICR1c2VfY3VybCA9IHRydWU7CgogICAgICAgIGlmICgkdXNlX2N1cmwpIHsKICAgICAgICAgICAgUGVyY2hVdGlsOjpkZWJ1ZygnQWN0aXZhdGluZyB2aWEgQ1VSTCcpOwogICAgICAgICAgICAkY2ggCT0gY3VybF9pbml0KCk7CgkJCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9VUkwsICR1cmwpOwoJCQljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUkVUVVJOVFJBTlNGRVIsIHRydWUpOwoJCQljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfVElNRU9VVCwgMTApOwoJCQljdXJsX3NldG9wdCgkY2gsIENVUkxPUFRfUE9TVCwgdHJ1ZSk7CgkJCWN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9QT1NURklFTERTLCAkY29udGVudCk7CiAgICAgICAgICAgIGN1cmxfc2V0b3B0KCRjaCwgQ1VSTE9QVF9WRVJCT1NFLCB0cnVlKTsKCQkJJHJlc3VsdCA9IGN1cmxfZXhlYygkY2gpOwoKCQkJUGVyY2hVdGlsOjpkZWJ1ZygkcmVzdWx0KTsKCQkJJGh0dHBfc3RhdHVzID0gKGludCljdXJsX2dldGluZm8oJGNoLCBDVVJMSU5GT19IVFRQX0NPREUpOwoKCQkJaWYgKCRodHRwX3N0YXR1cyE9MjAwKSB7CgkJCSAgICAkcmVzdWx0ID0gZmFsc2U7CgkJCSAgICBQZXJjaFV0aWw6OmRlYnVnKCdOb3QgSFRUUCAyMDA6ICcuJGh0dHBfc3RhdHVzKTsKCQkJfQoJCQljdXJsX2Nsb3NlKCRjaCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGlmIChmdW5jdGlvbl9leGlzdHMoJ2Zzb2Nrb3BlbicpKSB7CiAgICAgICAgICAgICAgICBQZXJjaFV0aWw6OmRlYnVnKCdBY3RpdmF0aW5nIHZpYSBzb2NrZXRzJyk7CiAgICAgICAgICAgICAgICAkZnAgPSBmc29ja29wZW4oJGhvc3QsIDgwLCAkZXJybm8sICRlcnJzdHIsIDEwKTsKICAgICAgICAgICAgICAgIGlmICgkZnApIHsKICAgICAgICAgICAgICAgICAgICAkb3V0ID0gIlBPU1QgJHBhdGggSFRUUC8xLjFcclxuIjsKICAgICAgICAgICAgICAgICAgICAkb3V0IC49ICJIb3N0OiAkaG9zdFxyXG4iOwogICAgICAgICAgICAgICAgICAgICRvdXQgLj0gIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXHJcbiI7CiAgICAgICAgICAgICAgICAgICAgJG91dCAuPSAiQ29udGVudC1MZW5ndGg6ICIgLiBzdHJsZW4oJGNvbnRlbnQpIC4gIlxyXG4iOwogICAgICAgICAgICAgICAgICAgICRvdXQgLj0gIkNvbm5lY3Rpb246IENsb3NlXHJcblxyXG4iOwogICAgICAgICAgICAgICAgICAgICRvdXQgLj0gJGNvbnRlbnQuICJcclxuIjsKCiAgICAgICAgICAgICAgICAgICAgZndyaXRlKCRmcCwgJG91dCk7CiAgICAgICAgICAgICAgICAgICAgc3RyZWFtX3NldF90aW1lb3V0KCRmcCwgMTApOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICghZmVvZigkZnApKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXN1bHQgLj0gIGZnZXRzKCRmcCwgMTI4KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZmNsb3NlKCRmcCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRyZXN1bHQhPScnKSB7CiAgICAgICAgICAgICAgICAgICAgJHBhcnRzID0gcHJlZ19zcGxpdCgnL1tcblxyXXs0fS8nLCAkcmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNfYXJyYXkoJHBhcnRzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkcmVzdWx0ID0gJHBhcnRzWzFdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gU2hvdWxkIGhhdmUgYSAkcmVzdWx0IG5vdwogICAgICAgIGlmICgkcmVzdWx0KSB7CiAgICAgICAgICAgICRqc29uID0gUGVyY2hVdGlsOjpqc29uX3NhZmVfZGVjb2RlKCRyZXN1bHQpOwogICAgICAgICAgICAvL3ByaW50X3IoJGpzb24pOwogICAgICAgICAgICBpZiAoaXNfb2JqZWN0KCRqc29uKSAmJiAkanNvbi0+cmVzdWx0ID09ICdTVUNDRVNTJykgewogICAgICAgICAgICAgICAgLy8gdXBkYXRlIGxhdGVzdCB2ZXJzaW9uIHNldHRpbmcKICAgICAgICAgICAgICAgICRTZXR0aW5ncyA9IG5ldyBQZXJjaFNldHRpbmdzOwogICAgICAgICAgICAgICAgJFNldHRpbmdzLT5zZXQoJ2xhdGVzdF92ZXJzaW9uJywgJGpzb24tPmxhdGVzdF92ZXJzaW9uKTsKICAgICAgICAgICAgICAgICRTZXR0aW5ncy0+c2V0KCdvbl9zYWxlX3ZlcnNpb24nLCAkanNvbi0+b25fc2FsZV92ZXJzaW9uKTsKCiAgICAgICAgICAgICAgICBQZXJjaFV0aWw6OmRlYnVnKCRqc29uKTsKICAgICAgICAgICAgICAgIFBlcmNoVXRpbDo6ZGVidWcoJ0FjdGl2YXRpb246IHN1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgIFBlcmNoVXRpbDo6ZGVidWcoJ0FjdGl2YXRpb246IGZhaWxlZCcpOwogICAgICAgICAgICAgICAgJHRoaXMtPmFjdGl2YXRpb25fZmFpbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gSWYgYWN0aXZhdGlvbiBjYW4ndCBjb21wbGV0ZSwgYXNzdW1lIGhvbmVzdHkuIFRoYXQncyBob3cgSSByb2xsLgoKICAgICAgICByZXR1cm4gJHJlc3VsdDsKICAgIH0KCglwdWJsaWMgZnVuY3Rpb24gYWN0aXZhdGVfZnJvbV9wbHVnaW4oKQoJewoJCXJldHVybiAkdGhpcy0+YWN0aXZhdGUoKTsKCX0KCglwdWJsaWMgZnVuY3Rpb24gaGFzX3ByaXYoJHByaXYpCgl7CiAgICAgICAgaWYgKFBFUkNIX1BST0RVQ1RJT05fTU9ERSA9PSBQRVJDSF9ERVZFTE9QTUVOVCkgewogICAgICAgICAgICAkdGhpcy0+bG9nX3ByaXYoJHByaXYpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5yb2xlTWFzdGVyQWRtaW4oKSkgcmV0dXJuIHRydWU7CgkgICAgcmV0dXJuIGluX2FycmF5KCRwcml2LCAkdGhpcy0+cHJpdmlsZWdlcyk7Cgl9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldF9wcml2cygpCiAgICB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5wcml2aWxlZ2VzOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBjYW5fdXNlX2J1Y2tldCgkYnVja2V0LCAkcHJpdnM9YXJyYXkoKSwgJGNoZWNrPSdhbnknKQogICAgewogICAgICAgIGlmICgkdGhpcy0+cm9sZU1hc3RlckFkbWluKCkpIHsKICAgICAgICAgICAgLy8gbWFzdGVyIGFkbWluIGNhbiB1c2UgZXZlcnl0aGluZywgbm8gbmVlZCB0byBjaGVjawogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICgkdGhpcy0+YnVja2V0cyA9PT0gbnVsbCkgewogICAgICAgICAgICAvLyBsYXp5IGxvYWQgdGhlIGJ1Y2tldCBwZXJtaXNzaW9ucwogICAgICAgICAgICAkdGhpcy0+X2xvYWRfYnVja2V0X3ByaXZpbGVnZXMoKTsKICAgICAgICB9CgogICAgICAgIGlmIChjb3VudCgkcHJpdnMpID09PSAwKSB7CiAgICAgICAgICAgICRwcml2cyA9IFsnc2VsZWN0JywgJ2luc2VydCcsICd1cGRhdGUnLCAnZGVsZXRlJ107CiAgICAgICAgfQoKICAgICAgICBpZiAoY291bnQoJHRoaXMtPmJ1Y2tldHMpID09PSAwKSB7CiAgICAgICAgICAgIC8vIHByaXZzIGFyZW4ndCBleHBsaWNpdGx5IHNldCBmb3IgdGhpcyByb2xlLCBzbyBhbGxvdyBpdC4gUGVybWlzc2l2ZSBieSBkZWZhdWx0LgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIC8vIGlmIG1hdGNoaW5nIGFsbCBwcml2cwogICAgICAgIGlmICgkY2hlY2sgPT0gJ2FsbCcpIHsKICAgICAgICAgICAgJGNvbW1vbiA9IGFycmF5X2ludGVyc2VjdCgkcHJpdnMsIChpc3NldCgkdGhpcy0+YnVja2V0c1skYnVja2V0XSkgPyAkdGhpcy0+YnVja2V0c1skYnVja2V0XSA6IFtdKSk7CiAgICAgICAgICAgIGlmIChjb3VudCgkY29tbW9uKSA9PSBjb3VudCgkcHJpdnMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZmFsc2U7ICAgIAogICAgICAgIH0KCiAgICAgICAgLy8gbWF0Y2ggYW55IHByaXZzCiAgICAgICAgZm9yZWFjaCgkcHJpdnMgYXMgJHByaXYpIHsKICAgICAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+YnVja2V0c1skYnVja2V0XSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGluX2FycmF5KCRwcml2LCAkdGhpcy0+YnVja2V0c1skYnVja2V0XSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldF9wcml2c19mb3JfYnVja2V0KCRidWNrZXQpCiAgICB7CiAgICAgICAgJHByaXZzID0gWydzZWxlY3QnLCAnaW5zZXJ0JywgJ3VwZGF0ZScsICdkZWxldGUnXTsKCiAgICAgICAgaWYgKCR0aGlzLT5idWNrZXRzID09PSBudWxsKSB7CiAgICAgICAgICAgIC8vIGxhenkgbG9hZCB0aGUgYnVja2V0IHBlcm1pc3Npb25zCiAgICAgICAgICAgICR0aGlzLT5fbG9hZF9idWNrZXRfcHJpdmlsZWdlcygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpc3NldCgkdGhpcy0+YnVja2V0c1skYnVja2V0XSkpIHsKICAgICAgICAgICAgaWYgKGNvdW50KCR0aGlzLT5idWNrZXRzKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNzZXQoJHRoaXMtPmJ1Y2tldHNbJGJ1Y2tldF0pKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+YnVja2V0c1skYnVja2V0XTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkcHJpdnM7CiAgICB9CgoJcHJpdmF0ZSBmdW5jdGlvbiBfbG9hZF9wcml2aWxlZ2VzKCkKCXsKICAgICAgICAvLyBwcml2cwogICAgICAgIGlmICghJHRoaXMtPnJvbGVNYXN0ZXJBZG1pbigpKSB7CiAgICAgICAgICAgICRzcWwgPSAnU0VMRUNUIHAucHJpdktleSBGUk9NICcuUEVSQ0hfREJfUFJFRklYLid1c2VycyB1LCAnLlBFUkNIX0RCX1BSRUZJWC4ndXNlcl9yb2xlX3ByaXZpbGVnZXMgcnAsICcuUEVSQ0hfREJfUFJFRklYLid1c2VyX3ByaXZpbGVnZXMgcAogICAgICAgICAgICAgICAgICAgIFdIRVJFIHUucm9sZUlEPXJwLnJvbGVJRCBBTkQgcnAucHJpdklEPXAucHJpdklEIEFORCB1LnVzZXJJRD0nLiR0aGlzLT5kYi0+cGRiKChpbnQpJHRoaXMtPmlkKCkpOwoKICAgICAgICAgICAgJHJvd3MgPSAkdGhpcy0+ZGItPmdldF9yb3dzKCRzcWwpOwogICAgICAgICAgICBpZiAoUGVyY2hVdGlsOjpjb3VudCgkcm93cykpIHsKICAgICAgICAgICAgICAgICRwcml2cyA9IGFycmF5KCk7CiAgICAgICAgICAgICAgICBmb3JlYWNoKCRyb3dzIGFzICRyb3cpIHsKICAgICAgICAgICAgICAgICAgICAkcHJpdnNbXSA9ICRyb3dbJ3ByaXZLZXknXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICR0aGlzLT5wcml2aWxlZ2VzID0gJHByaXZzOwogICAgICAgICAgICB9CiAgICAgICAgfQkgICAgCgoJfQoKICAgIHByaXZhdGUgZnVuY3Rpb24gX2xvYWRfYnVja2V0X3ByaXZpbGVnZXMoKQogICAgewogICAgICAgIGlmICghUEVSQ0hfUlVOV0FZKSB7CiAgICAgICAgICAgICR0aGlzLT5idWNrZXRzID0gW107CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGJ1Y2tldCBwcml2cwogICAgICAgIGlmICghJHRoaXMtPnJvbGVNYXN0ZXJBZG1pbigpKSB7CiAgICAgICAgICAgICRzcWwgPSAnU0VMRUNUICogRlJPTSAnLlBFUkNIX0RCX1BSRUZJWC4ndXNlcl9yb2xlX2J1Y2tldHMgV0hFUkUgcm9sZUlEPScuJHRoaXMtPmRiLT5wZGIoKGludCkkdGhpcy0+cm9sZUlEKCkpOwogICAgICAgICAgICAkcm93cyA9ICR0aGlzLT5kYi0+Z2V0X3Jvd3MoJHNxbCk7CiAgICAgICAgICAgIGlmIChQZXJjaFV0aWw6OmNvdW50KCRyb3dzKSkgewogICAgICAgICAgICAgICAgJHByaXZzID0gWydyb2xlU2VsZWN0JywgJ3JvbGVJbnNlcnQnLCAncm9sZVVwZGF0ZScsICdyb2xlRGVsZXRlJywgJ3JvbGVEZWZhdWx0J107CiAgICAgICAgICAgICAgICAkdGhpcy0+YnVja2V0cyA9IFtdOwogICAgICAgICAgICAgICAgZm9yZWFjaCgkcm93cyBhcyAkcm93KSB7CiAgICAgICAgICAgICAgICAgICAgJHRtcCA9IFtdOwogICAgICAgICAgICAgICAgICAgIGZvcmVhY2goJHByaXZzIGFzICRwcml2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcm93WyRwcml2XSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRtcFtdID0gc3RyX3JlcGxhY2UoJ3JvbGUnLCAnJywgc3RydG9sb3dlcigkcHJpdikpOwogICAgICAgICAgICAgICAgICAgICAgICB9ICAgIAogICAgICAgICAgICAgICAgICAgIH0gICAgICAgCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmJ1Y2tldHNbJHJvd1snYnVja2V0J11dID0gJHRtcDsKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCR0aGlzLT5idWNrZXRzID09PSBudWxsKSB7CiAgICAgICAgICAgICR0aGlzLT5idWNrZXRzID0gW107CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgZnVuY3Rpb24gc2VuZF9sb2Nrb3V0X2VtYWlsKCR1c2VySUQpCiAgICB7CiAgICAgICAgJFVzZXJzID0gbmV3IFBlcmNoVXNlcnM7CiAgICAgICAgJFVzZXIgPSAkVXNlcnMtPmZpbmQoKGludCkkdXNlcklEKTsKICAgICAgICAkVXNlci0+c2VuZF9sb2Nrb3V0X2VtYWlsKCk7CiAgICB9CgogICAgcHJpdmF0ZSBmdW5jdGlvbiBsb2dfcHJpdigkcHJpdikKICAgIHsKICAgICAgICBpZiAoUEVSQ0hfUFJJVl9BU1NJU1QpIHsKICAgICAgICAgICAgJHNxbCA9ICdTRUxFQ1QgQ09VTlQoKikgRlJPTSAnLlBFUkNIX0RCX1BSRUZJWC4ndXNlcl9wcml2aWxlZ2VzIFdIRVJFIHByaXZLZXk9Jy4kdGhpcy0+ZGItPnBkYigkcHJpdik7CiAgICAgICAgICAgIGlmICgkdGhpcy0+ZGItPmdldF9jb3VudCgkc3FsKT09MCkgewogICAgICAgICAgICAgICAgJHNxbCA9ICdJTlNFUlQgSU5UTyAnLlBFUkNIX0RCX1BSRUZJWC4ndXNlcl9wcml2aWxlZ2VzIChwcml2S2V5LCBwcml2VGl0bGUpCiAgICAgICAgICAgICAgICAgICAgICAgIFZBTFVFUyggJy4kdGhpcy0+ZGItPnBkYigkcHJpdikuJywgJy4kdGhpcy0+ZGItPnBkYigkcHJpdikuJyknOwogICAgICAgICAgICAgICAgJHRoaXMtPmRiLT5leGVjdXRlKCRzcWwpOyAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo='));
